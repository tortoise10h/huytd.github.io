<html>
    <head>
        <title> Viáº¿t test trong Rust the idiomatic way | Huy's Blog</title>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
        
        <link href="../css/inconsolata.css" rel="stylesheet" type="text/css">
        <link href="../css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../css/highlight/tomorrow.css">
        <link rel="stylesheet" href="../css/fontello.css">
        <script src="../js/highlight.pack.js"></script>
        <script>
        hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="header">
            <a href="/"><i class="icon icon-emo-coffee"></i> Huy's Blog</a>
        </div>
        <div class="container">
            <div class="main">
                <h1 id="vi-t-test-trong-rust-the-idiomatic-way">Viáº¿t test trong Rust the idiomatic way</h1>
<p><strong>Chá»‘ng chá»‰ Ä‘á»‹nh:</strong> cÃ¡i tiÃªu Ä‘á» Ä‘áº·t ná»¯a tÃ¢y ná»¯a viá»‡t lÃ  cá»‘ Ã½, Ä‘á»ƒ cÃ¢u view, chá»© thá»±c ra khÃ´ng pháº£i táº¡i mÃ¬nh khÃ´ng biáº¿t dá»‹ch chá»¯ <code>idiomatic</code> ra Ä‘Ã¢u :v Ã€ nhÃ¢n tiá»‡n nÃ³i luÃ´n, <code>idiomatic way</code> cÃ³ nghÄ©a lÃ  <code>má»™t cÃ¡ch chÃ­nh thá»‘ng</code>, á»Ÿ Ä‘Ã¢y bÃ n vá» cÃ¡ch viáº¿t test Ä‘Æ°á»£c cá»™ng Ä‘á»“ng Rustlang cÃ´ng nháº­n vÃ  khuyáº¿n khÃ­ch.</p>
<p><img src="img/rustlang-vietnam-comic.png" alt=""></p>
<p>Testing lÃ  má»™t chá»©c nÄƒng quan trá»ng mÃ  báº¥t kÃ¬ ngÃ´n ngá»¯ nÃ o cÅ©ng cáº§n pháº£i cÃ³, viáº¿t unit test cÅ©ng lÃ  má»™t viá»‡c mÃ  báº¥t kÃ¬ láº­p trÃ¬nh viÃªn nÃ o cÅ©ng cáº§n pháº£i lÃ m, tháº­m chÃ­ vá»›i má»™t vÃ i cá»™ng Ä‘á»“ng nhÆ° Golang vÃ  Ruby thÃ¬ ngÆ°á»i ta báº£o thá»§ tá»›i má»©c xem viá»‡c publish má»™t project khÃ´ng cÃ³ unit test giá»‘ng nhÆ° lÃ  má»™t cÃ¡i tá»™i luÃ´n váº­y Ä‘Ã³ :)) </p>
<p>Äá»‘i vá»›i Go thÃ¬ chÃºng ta cÃ³ <code>go test</code>, Ä‘á»‘i vá»›i Ruby chÃºng ta cÃ³ thá»ƒ cháº¡y test thÃ´ng qua <code>rake</code> (Ä‘Ãºng khÃ´ng nhá»‰? má»™t thanh niÃªn khÃ´ng code Ruby cho hay), Node thÃ¬ thÃ´i khÃ´ng nÃªn nháº¯c tá»›i lÃ m gÃ¬ :( vÃ  táº¥t nhiÃªn lÃ  Rust cÅ©ng cÃ³ cÃ´ng cá»¥ testing built-in thÃ´ng qua lá»‡nh <code>cargo test</code>.</p>
<h2 id="c-ch-test-trong-rust">CÃ¡ch test trong Rust</h2>
<p>Äá»ƒ viáº¿t test trong Rust thÃ¬ khÃ¡ lÃ  Ä‘Æ¡n giáº£n, chá»‰ cáº§n táº¡i báº¥t kÃ¬ Ä‘Ã¢u trong chÆ°Æ¡ng trÃ¬nh, viáº¿t má»™t hÃ m theo dáº¡ng:</p>
<pre><code>#[test]
fn minh_thich_thi_minh_test_thoi() {
  ...
}
</code></pre><p>HÃ m nÃ y cÃ³ attribute <code>#[test]</code> (dÃ¢n Java, C#, thÆ°á»ng gá»i cÃ¡i nÃ y lÃ  annotation) Ä‘á»ƒ bÃ¡o cho Rust compiler biáº¿t ráº±ng Ä‘Ã¢y lÃ  má»™t hÃ m test, cÃ¡c hÃ m nÃ y sáº½ Ä‘Æ°á»£c cháº¡y khi chÃºng ta gá»i lá»‡nh:</p>
<pre><code>cargo test
</code></pre><p>VÃ­ dá»¥, ta viáº¿t má»™t hÃ m test nhÆ° sau:</p>
<pre><code>#[test]
fn this_function_should_drop_all_tables() {
    assert!(1 + 1 == 2)
}
</code></pre><p>VÃ  cháº¡y test, ta thu Ä‘Æ°á»£c káº¿t quáº£:</p>
<pre><code>âœ  kipalog git:(master) âœ— cargo test
   Compiling testrun v0.1.0 (file:///Users/huy/code/kipalog)
    Finished debug [unoptimized + debuginfo] target(s) in 0.27 secs
     Running target/debug/kipalog-90d752c0679f22d9

running 1 test
test this_function_should_drop_all_tables ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured
</code></pre><h2 id="idiomatic-way-vi-t-test-trong-rust">Idiomatic way Ä‘á»ƒ viáº¿t test trong Rust</h2>
<p>Theo cuá»‘n sÃ¡ch <a href="https://doc.rust-lang.org/book/testing.html">The Rust Programming Language</a>, cá»™ng Ä‘á»“ng Rust khuyáº¿n khÃ­ch 2 cÃ¡ch viáº¿t test &quot;chuáº©n&quot; Ä‘Ã³ lÃ : <strong>Viáº¿t trong <code>tests</code> module</strong> vÃ  <strong>Viáº¿t trong thÆ° má»¥c <code>tests</code></strong>. Váº­y táº¡i sao láº¡i cÃ³ 2 cÃ¡ch viáº¿t?</p>
<h3 id="d-ng-tests-module-vi-t-unit-test">DÃ¹ng <code>tests</code> module Ä‘á»ƒ viáº¿t Unit Test</h3>
<p>Äá»ƒ táº¡o <code>tests</code> module thÃ¬ chÃºng ta cÃ³ thá»ƒ viáº¿t code sau á»Ÿ báº¥t kÃ¬ Ä‘Ã¢u:</p>
<pre><code>#[cfg(test)]
mod tests {

}
</code></pre><p>Tá»« khÃ³a <code>mod</code> Ä‘á»ƒ táº¡o má»™t module má»›i, vÃ  khi gáº·p attribute <code>#[cfg(test)]</code>, Rust compiler sáº½ chá»‰ compile module nÃ y khi cháº¡y test, khi build bÃ¬nh thÆ°á»ng thÃ¬ module nÃ y sáº½ bá»‹ bá» qua Ä‘á»ƒ tiáº¿t kiá»‡m thá»i gian compile.</p>
<p>Giáº£ sá»­ chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta cÃ³ má»™t hÃ m cáº§n test lÃ  <code>sum()</code>, chÃºng ta sáº½ viáº¿t test cho hÃ m nÃ y nhÆ° sau:</p>
<pre><code>fn sum(a: i32, b: i32) -&gt; i32 {
    a + b
}

#[cfg(test)]
mod tests {
    use super::sum;

    #[test]
    fn sum_should_return_something() {
        assert!(sum(1, 2) == 3)
    }
}
</code></pre><p>LÆ°u Ã½ lá»‡nh:</p>
<pre><code>use super::sum;
</code></pre><p>VÃ¬ hÃ m <code>sum</code> cá»§a chÃºng ta khÃ´ng Ä‘Æ°á»£c khai bÃ¡o bÃªn trong module <code>tests</code> nÃªn trÆ°á»›c khi sá»­ dá»¥ng nÃ³ trong hÃ m test, chÃºng ta pháº£i Ä‘Æ°a nÃ³ vÃ o scope cá»§a module hiá»‡n hÃ nh báº±ng lá»‡nh <code>use</code>.</p>
<p>Cháº¡y thá»­ bá»™ test trÃªn sáº½ cho káº¿t quáº£ nhÆ° sau:</p>
<pre><code>âœ  kipalog git:(master) âœ— cargo test
    Finished debug [unoptimized + debuginfo] target(s) in 0.0 secs
     Running target/debug/kipalog-e90e21d36164f8bb

running 1 test
test tests::sum_should_return_something ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured
</code></pre><p>Báº¡n sáº½ tháº¥y test case Ä‘Æ°á»£c cháº¡y bÃ¢y giá» lÃ  <code>tests::sum_should_return_something</code>, tá»©c lÃ  Rust Ä‘Ã£ cháº¡y test cho hÃ m <code>sum_should_return_something</code> thuá»™c module <code>tests</code>, khÃ¡c vá»›i káº¿t quáº£ Ä‘Æ°á»£c in ra á»Ÿ vÃ­ dá»¥ test má»™t hÃ m Ä‘Æ¡n láº» á»Ÿ Ä‘áº§u bÃ i.</p>
<p>CÃ¡c test Ä‘Æ°á»£c viáº¿t trong module nÃ y thÆ°á»ng sáº½ lÃ  cÃ¡c <strong>unit test</strong>.</p>
<h3 id="d-ng-th-m-c-tests-vi-t-integration-tests">DÃ¹ng thÆ° má»¥c <code>tests</code> Ä‘á»ƒ viáº¿t integration tests</h3>
<p>NgoÃ i cÃ¡ch test á»Ÿ trÃªn, chÃºng ta cÃ³ thá»ƒ táº¡o thÆ° má»¥c <code>tests</code> náº±m cÃ¹ng cáº¥p vá»›i thÆ° má»¥c <code>src</code> cá»§a dá»± Ã¡n, vÃ  viáº¿t cÃ¡c file test á»Ÿ trong nÃ y. Má»—i má»™t file <code>*.rs</code> náº±m trong thÆ° má»¥c nÃ y Ä‘Æ°á»£c xem nhÆ° lÃ  má»™t crate riÃªng, vÃ  khi compile cÅ©ng sáº½ náº±m á»Ÿ má»™t target riÃªng, cÃ¡c báº¡n lÆ°u Ã½ chá»— nÃ y.</p>
<p>Äá»ƒ viáº¿t cÃ¡c integration test thÃ¬ chÃºng ta táº¡o file <code>tests/integration_tests.rs</code>. </p>
<p>Giáº£ sá»­ chÃºng ta cÃ³ module <code>kipalog</code> vÃ  cÃ³ hÃ m <code>sum()</code> nhÆ° Ä‘Ã£ khai bÃ¡o á»Ÿ pháº§n trÆ°á»›c, ná»™i dung file test cá»§a chÃºng ta sáº½ cÃ³ dáº¡ng:</p>
<pre><code>extern crate kipalog;

#[test]
fn test_sum_one_and_two() {
    assert!(kipalog::sum(1, 2) == 3);
}
</code></pre><p>NhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn, vÃ¬ bÃªn trong thÆ° má»¥c <code>tests</code>, má»—i file lÃ  má»™t crate riÃªng, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  chÃºng ta pháº£i import module <code>kipalog</code> vÃ o, giá»‘ng vá»›i cÃ¡ch sá»­ dá»¥ng crate trong thá»±c táº¿, vÃ¬ váº­y cÃ¡ch nÃ y thÃ­ch há»£p Ä‘á»ƒ viáº¿t integration test.</p>
<p>Cháº¡y test trÃªn thÃ¬ output sáº½ cÃ³ dáº¡ng:</p>
<pre><code>âœ  kipalog git:(master) âœ— cargo test
   Compiling kipalog v0.1.0 (file:///Users/huy/Desktop/Code/kipalog)
    Finished debug [unoptimized + debuginfo] target(s) in 0.41 secs
     Running target/debug/integration_tests-e2d20617c9c89446

running 1 test
test test_sum_one_and_two ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured

     Running target/debug/deps/kipalog-f232ef2295608ede

running 1 test
test tests::sum_should_return_something ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured

   Doc-tests kipalog

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured
</code></pre><p>CÃ³ thá»ƒ tháº¥y trong output chia lÃ m 3 pháº§n, pháº§n Ä‘áº§u tiÃªn lÃ  káº¿t quáº£ cháº¡y test Ä‘Æ°á»£c viáº¿t trong <code>integration_tests.rs</code> cá»§a chÃºng ta, pháº§n 2 lÃ  pháº§n code test trong module <code>tests</code> Ä‘Ã£ viáº¿t á»Ÿ pháº§n trÆ°á»›c. Pháº§n cuá»‘i cÃ¹ng lÃ  <code>Doc-tests</code>, lÃ  má»™t chá»©c nÄƒng cá»§a Rust cho phÃ©p test luÃ´n code trong document, cÃ¡c báº¡n cÃ³ thá»ƒ xem chi tiáº¿t táº¡i bÃ i <a href="https://doc.rust-lang.org/book/testing.html">The Rust Programming Language - Testing</a>.</p>
<hr>
<p>Má»™t phÃºt dÃ nh cho quáº£ng cÃ¡o: Cá»™ng Ä‘á»“ng Rustlang Viá»‡t Nam Ä‘Ã£ Ä‘Æ°á»£c thÃ nh láº­p, cÃ¡c báº¡n cÃ³ thá»ƒ tham gia táº¡i cÃ¡c Ä‘á»‹a chá»‰ sau:</p>
<p><img src="img/rustlang-vietnam-social.png" alt=""></p>
<div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='https://huytd.github.io/tags/tdd.html'>tdd</a><a class='topic-tag' href='https://huytd.github.io/tags/rust.html'>rust</a></div>
                <div class="copyright">
                Báº¡n Ä‘Æ°á»£c tÃ¹y Ã½ báº¥m like, trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n vÃ  tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, mÃ¬nh hy vá»ng tá»« nay vá» sau báº¡n sáº½ luÃ´n cáº£m tháº¥y cáº¯n rá»©t lÆ°Æ¡ng tÃ¢m, Äƒn khÃ´ng ngon, ngá»§ khÃ´ng yÃªn. ğŸ˜†
                </div>
            </div>
        </div>
	    <div class="footer">
            <p>Created with <a href="http://github.com/huytd/azeroth-js">azeroth.js</a></p>
            <div class="social">
                <a target="_blank" href="http://facebook.com/kingbazoka"><i class="icon-facebook-squared"></i></a>
                <a target="_blank" href="http://twitter.com/huydotnet"><i class="icon-twitter-squared"></i></a>
                <a target="_blank" href="http://github.com/huytd"><i class="icon-github-squared"></i></a>
                <a target="_blank" href="https://thefullsnack.com"><i class="icon-emo-coffee"></i></a>
            </div>
        </div>
        <script type="text/javascript" async src="https://cdn.rawgit.com/mathjax/MathJax/2.7.0/MathJax.js"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea"]
          }
        });
        </script>
    </body>
</html>

<html>
    <head>
        <title> Tự tạo SSH tunnel để forward port ra remote server | Huy's Blog</title>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700">
        <link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic&subset=latin,vietnamese' rel='stylesheet' type='text/css'>
        <link href="../css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../css/highlight/tomorrow.css">
        <link rel="stylesheet" href="../css/fontello.css">
        <script src="../js/highlight.pack.js"></script>
        <script>
        hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="header">
            <a href="/"><i class="icon icon-emo-coffee"></i> Huy's Blog</a>
        </div>
        <div class="container">
            <div class="main">
                <h1 id="t-t-o-ssh-tunnel-forward-port-ra-remote-server">Tự tạo SSH tunnel để forward port ra remote server</h1>
<p>Khi làm việc, đôi lúc bạn chạy server ở localhost nhưng cần truy cập vào nó từ một thiết bị khác không cùng trong mạng nội bộ, ví dụ chạy web để demo cho khách hàng xem, hoặc muốn test API trên localhost của bạn từ mobile app.</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/kipalog.com/case1.png_b3vpziib2q" alt="alt text"></p>
<p>Khi đó bạn cần phải forward port mà server app của bạn đang sử dụng (localhost) ra một server bên ngoài (remote server) để người khác có thể truy cập vào. </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/kipalog.com/case2.png_jqff6yueh0" alt="alt text"></p>
<p>Để làm điều này thì bạn có thể sử dụng các dịch vụ như <a href="https://ngrok.com/">ngrok</a>, <a href="https://pagekite.net/">PageKite</a>, <a href="https://forwardhq.com/">Forward</a>.</p>
<p>Nhưng nếu có một server riêng thì chúng ta hoàn toàn có thể tự setup một dịch vụ như vậy để xài riêng mà không cần phải phụ thuộc vào ai. Bằng cách sử dụng SSH tunnel.</p>
<h2 id="setup-t-ph-a-server">Setup từ phía server</h2>
<p>Yêu cầu đầu tiên là server phải được setup để truy cập được từ bên ngoài (giả sử có domain là <code>kipalol.com</code>) và phải hỗ trợ SSH.</p>
<p>Truy cập vào server và thêm dòng cấu hình <code>GatewayPorts</code> vào file <code>/etc/ssh/sshd_config</code> như sau:</p>
<pre><code>GatewayPorts yes
</code></pre><p>Sau đó thì restart lại SSH server:</p>
<pre><code>service ssh restart
</code></pre><h2 id="t-o-tunnel-t-ph-a-localhost">Tạo tunnel từ phía localhost</h2>
<p>Giả sử trên localhost của bạn đang chạy một Rails app ở cổng <code>3000</code>, và bạn muốn mọi người có thể truy cập vào Rails app này thông qua cổng <code>9000</code> từ phía server của bạn. Ví dụ: <a href="http://kipalol.com:9000">http://kipalol.com:9000</a></p>
<p>Ta chạy lệnh sau trên máy localhost:</p>
<pre><code>ssh -N -R 9000:localhost:3000 user@kipalol.com
</code></pre><p>Các tham số:</p>
<ul>
<li><code>-N</code> để đảm bảo là bạn không kết nối ở chế độ login vào SSH server</li>
<li><code>-R</code> để tạo tunnel tới server</li>
<li><code>9000</code> là cổng ở server mà bạn muốn mở để truy cập vào Rails app ở localhost</li>
<li><code>localhost:3000</code> là địa chỉ truy cập và cổng của Rails app</li>
<li><code>user@kipalol.com</code> là user và địa chỉ truy cập mà bạn dùng để SSH vào server </li>
</ul>
<p>Từ bây giờ, user có thể truy cập vào <a href="http://kipalol.com:9000">http://kipalol.com:9000</a> để truy cập trực tiếp vào Rails app mà bạn đang chạy trên máy cá nhân của mình. </p>
<p>Ngoài ra các bạn có thể tìm hiểu thêm về các ứng dụng khác của SSH tunnel qua <a href="http://kipalog.com/posts/Gioi-thieu-SSH-Tunnel-va-mot-so-ung-dung">bài này</a> </p>

                <div class="fb-like" data-href="http://huytd.github.io/posts/ssh-tunnel-reverse-proxy.html" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
                <div id="disqus_thread"></div>
                <script>
                /**
                * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                */
                /*
                var disqus_config = function () {
                this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                };
                */
                (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = '//huysblog.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
	    <div class="footer">
            <p>Created with <a href="http://github.com/huytd/azeroth-js">azeroth.js</a></p>
            <div class="social">
                <a target="_blank" href="http://facebook.com/kingbazoka"><i class="icon-facebook-squared"></i></a>
                <a target="_blank" href="http://twitter.com/huydotnet"><i class="icon-twitter-squared"></i></a>
                <a target="_blank" href="http://github.com/huytd"><i class="icon-github-squared"></i></a>
                <a target="_blank" href="https://thefullsnack.com"><i class="icon-emo-coffee"></i></a>
            </div>
        </div>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-71353335-1', 'auto');
          ga('send', 'pageview');
        </script>
        <script>
          window.fbAsyncInit = function() {
            FB.init({
              appId      : '462066520669072',
              xfbml      : true,
              version    : 'v2.6'
            });

            FB.Event.subscribe('edge.create', function(url) {
              ga('send', 'social', 'facebook', 'like', url);
            });
          };

          (function(d, s, id){
             var js, fjs = d.getElementsByTagName(s)[0];
             if (d.getElementById(id)) {return;}
             js = d.createElement(s); js.id = id;
             js.src = "//connect.facebook.net/en_US/sdk.js";
             fjs.parentNode.insertBefore(js, fjs);
           }(document, 'script', 'facebook-jssdk'));
        </script>
        <script id="dsq-count-scr" src="//huysblog.disqus.com/count.js" async></script>
        <script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea"]
          }
        });
        </script>
    </body>
</html>

<html>
    <head>
        <title> NhÃ¢n ma tráº­n - Pháº§n 2: TÃ­nh toÃ¡n trÃªn GPU | Huy's Blog</title>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
        
        <link href="../css/inconsolata.css" rel="stylesheet" type="text/css">
        <link href="../css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../css/highlight/tomorrow.css">
        <link rel="stylesheet" href="../css/fontello.css">
        <script src="../js/highlight.pack.js"></script>
        <script>
        hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="header">
            <a href="/"><i class="icon icon-emo-coffee"></i> Huy's Blog</a>
        </div>
        <div class="container">
            <div class="main">
                <h1 id="nh-n-ma-tr-n-ph-n-2-t-nh-to-n-tr-n-gpu">NhÃ¢n ma tráº­n - Pháº§n 2: TÃ­nh toÃ¡n trÃªn GPU</h1>
<p>Sau khi viáº¿t xong <a href="https://huytd.github.io/posts/nhan-ma-tran.html">bÃ i Ä‘áº§u tiÃªn</a>, mÃ¬nh tiáº¿p tá»¥c tÃ¬m hiá»ƒu sÃ¢u hÆ¡n vá» ma tráº­n vÃ  cáº£m tháº¥y cáº§n pháº£i viáº¿t thÃªm má»™t (vÃ i) bÃ i ná»¯a vÃ¬ cÃ³ quÃ¡ nhiá»u thá»© hay ho khi Ä‘i sÃ¢u vÃ o.</p>
<p>Trong pháº§n nÃ y, mÃ¬nh giá»›i thiá»‡u vá» phÆ°Æ¡ng phÃ¡p sá»­ dá»¥ng GPU Ä‘á»ƒ thá»±c hiá»‡n phÃ©p tÃ­nh nhÃ¢n 2 ma tráº­n (GPU Calculation), thay cho viá»‡c dÃ¹ng CPU truyá»n thá»‘ng, Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ tÃ­nh toÃ¡n.</p>
<h2 id="t-i-sao-l-i-l-gpu-c-c-vi-c-t-nh-to-n-tr-n-gpu-sao-">Táº¡i sao láº¡i lÃ  GPU? cÃ³ cáº£ viá»‡c tÃ­nh toÃ¡n trÃªn GPU sao?</h2>
<p>CÃ¢u tráº£ lá»i lÃ  cÃ³, thÆ°a cÃ¡c báº¡n. ChÃºng ta Ä‘á»u biáº¿t GPU lÃ  má»™t thÃ nh pháº§n trong card Ä‘á»“ há»a, thÆ°á»ng Ä‘Æ°á»£c giá»›i game thá»§ mua vá» cáº¯m vÃ´ cho mÃ¡y tÃ­nh xá»­ lÃ½ Ä‘á»“ há»a nhanh hÆ¡n. Váº­y thao tÃ¡c xá»­ lÃ½ Ä‘á»“ há»a á»Ÿ Ä‘Ã¢y lÃ  gÃ¬? </p>
<p>Äá»ƒ hiá»ƒu Ä‘Æ°á»£c chá»©c nÄƒng cá»§a GPU, hÃ£y cÃ¹ng lÃ¡i chá»§ Ä‘á» má»™t tÃ­ sang lÄ©nh vá»±c Ä‘á»“ há»a mÃ¡y tÃ­nh, viáº¿t Ä‘áº¿n Ä‘Ã¢y mÃ¬nh tháº¥y hÆ¡i bá»‹ mÃ¡u vÃ¬ dÃ¹ Ä‘Ã£ tá»« bá» ngÃ nh game Ä‘Æ°á»£c hÆ¡n 1 nÄƒm rá»“i nhÆ°ng giá» váº«n cÃ³ cÆ¡ há»™i quay láº¡i viáº¿t tiáº¿p vá» nÃ³, hÃª hÃª, láº¡c Ä‘á» tÃ­ thÃ´i, cÃ¡c báº¡n cÅ©ng yÃªn tÃ¢m vÃ¬ mÃ¬nh sáº½ khÃ´ng Ä‘á»ƒ bÃ i viáº¿t nÃ y thÃ nh bÃ i hÆ°á»›ng dáº«n lÃ m game gÃ¬ Ä‘Ã¢u =)))</p>
<h3 id="m-y-t-nh-t-o-ra-h-nh-nh-nh-th-n-o-">MÃ¡y tÃ­nh táº¡o ra hÃ¬nh áº£nh nhÆ° tháº¿ nÃ o?</h3>
<p>Má»™t hÃ¬nh áº£nh trÃªn mÃ¡y tÃ­nh Ä‘Æ°á»£c cáº¥u táº¡o thÃ nh tá»«ng pixel, Ä‘iá»u nÃ y háº³n ai cÅ©ng biáº¿t, nhÆ°ng lÃ m tháº¿ nÃ o Ä‘á»ƒ mÃ¡y tÃ­nh hiá»ƒu vÃ  váº½ Ä‘Æ°á»£c má»™t hÃ¬nh áº£nh thÃ nh má»™t tá»• há»£p cÃ¡c pixel Ä‘Æ°a lÃªn mÃ n hÃ¬nh qua sá»± chá»‰ Ä‘áº¡o cá»§a chÆ°Æ¡ng trÃ¬nh (application)?</p>
<p><img src="http://ithare.com/wp-content/uploads/BB_part114_BookChapter014h_v3.png" alt=""></p>
<center><em>Nguá»“n: <a href="http://ithare.com/game-graphics-101-rendering-pipeline/">http://ithare.com/game-graphics-101-rendering-pipeline/</a></em></center>

<p>Trong trÆ°á»ng há»£p lÃ  game thÃ¬ cÃ¡c dá»¯ liá»‡u hÃ¬nh áº£nh (3d mesh, texture,...) sáº½ Ä‘Æ°á»£c load tá»« Ä‘Ä©a (hard disk, file,...) vÃ  truyá»n vÃ o GPU. Táº¡i Ä‘Ã¢y, GPU sáº½ tiáº¿n hÃ nh phÃ¢n tÃ­ch vÃ  thá»±c hiá»‡n nhá»¯ng cÃ´ng viá»‡c tÃ­nh toÃ¡n cáº§n thiáº¿t Ä‘á»ƒ chuyá»ƒn chÃºng thÃ nh táº­p há»£p cÃ¡c pixel gá»­i tráº£ vá» CPU Ä‘á»ƒ váº½ ra mÃ n hÃ¬nh mÃ¡y tÃ­nh (IO devices).</p>
<p>QuÃ¡ trÃ¬nh tÃ­nh toÃ¡n Ä‘Ã³ á»Ÿ trong GPU, Ä‘Æ°á»£c gá»i lÃ  <strong>Rendering Pipeline</strong>, trong hÃ¬nh minh há»a á»Ÿ trÃªn thÃ¬ dÃ¢y chuyá»n váº­n chuyá»ƒn cÃ¡c khá»‘i há»™p pixel kia chÃ­nh lÃ  pipeline.</p>
<h3 id="rendering-pipeline">Rendering Pipeline</h3>
<p>Má»™t váº­t thá»ƒ 3D trong mÃ¡y tÃ­nh Ä‘Æ°á»£c cáº¥u thÃ nh tá»« nhiá»u Ä‘á»‰nh, gá»i lÃ  <strong>vertex</strong>, máº£ng cÃ¡c vertex Ä‘Æ°á»£c gá»i lÃ  <strong>vertices</strong> array.</p>
<p><img src="img/mesh_1.png" alt=""></p>
<p>HÃ¬nh trÃªn cho tháº¥y má»™t khá»‘i há»™p Ä‘Æ°á»£c táº¡o tá»« máº£ng $v$ gá»“m cÃ¡c Ä‘á»‰nh <code>$v_{0}, v_{1}, \ldots, v_{7}$</code></p>
<p>Trong mÃ¡y tÃ­nh, má»i hÃ¬nh áº£nh tá»« Ä‘Æ¡n giáº£n hay phá»©c táº¡p Ä‘á»u Ä‘Æ°á»£c táº¡o thÃ nh tá»« cÃ¡c vertices nhÆ° váº­y.</p>
<p><img src="img/mesh_2.png" alt=""></p>
<p>Render Pipeline lÃ  quÃ¡ trÃ¬nh xáº£y ra trong GPU, khi nÃ³ nháº­n má»™t táº­p há»£p cÃ¡c vertices, tráº£i qua cÃ¡c bÆ°á»›c xá»­ lÃ½ káº¿t ná»‘i cÃ¡c vertices láº¡i vá»›i nhau (vertex processing) thÃ nh cÃ¡c khá»‘i 3D cÆ¡ báº£n (thÆ°á»ng lÃ  cÃ¡c khá»‘i tam giÃ¡c, gá»i lÃ  3D primitives), sau Ä‘Ã³ phÃ¢n tÃ­ch (rasterization) cÃ¡c hÃ¬nh khá»‘i 3D nÃ y thÃ nh tá»«ng máº£nh nhá» (fragments), thá»±c hiá»‡n viá»‡c tÃ­nh toÃ¡n tÃ´ mÃ u, Ä‘á»• bÃ³ng,... cho cÃ¡c khá»‘i nÃ y rá»“i Ã¡nh xáº¡ nÃ³ thÃ nh máº£ng cÃ¡c pixel tÆ°Æ¡ng á»©ng vá»›i mÃ n hÃ¬nh mÃ¡y tÃ­nh, gá»­i tráº£ vá» CPU Ä‘á»ƒ Ä‘Æ°a lÃªn mÃ n hÃ¬nh.</p>
<p>VÃ¬ quy trÃ¬nh nÃ y diá»…n ra liÃªn tá»¥c vá»›i tá»‘c Ä‘á»™ cá»±c kÃ¬ cao Ä‘á»ƒ Ä‘áº£m báº£o cho viá»‡c hiá»ƒn thá»‹ hÃ¬nh áº£nh lÃªn mÃ n hÃ¬nh diá»…n ra xuyÃªn suá»‘t vÃ  mÆ°á»£t mÃ , nÃªn GPU pháº£i lÃ m viá»‡c vá»›i má»™t khá»‘i lÆ°á»£ng cÃ¡c phÃ©p tÃ­nh cá»±c kÃ¬ lá»›n. NÃ³i nhÆ° váº­y thÃ¬ khÃ´ng cÃ³ nghÄ©a lÃ  CPU khÃ´ng cÃ³ kháº£ nÄƒng dá»±ng hÃ¬nh áº£nh Ä‘á»“ há»a trÃªn mÃ¡y tÃ­nh, báº£n thÃ¢n CPU cÅ©ng cÃ³ thá»ƒ lÃ m Ä‘Æ°á»£c nhÆ°ng sáº½ khÃ´ng Ä‘áº¡t Ä‘Æ°á»£c performance nhÆ° GPU, lÃ½ do táº¡i sao xin má»i cÃ¡c báº¡n xem tiáº¿p.</p>
<h3 id="gpu-vs-cpu">GPU vs CPU</h3>
<p>HÃ¬nh sau so sÃ¡nh kiáº¿n trÃºc cá»§a má»™t CPU so vá»›i má»™t GPU:</p>
<p><img src="img/cpuvsgpu1.png" alt=""></p>
<p>CÃ¡c báº¡n cÃ³ thá»ƒ tháº¥y khá»‘i tÃ­nh toÃ¡n cá»§a GPU nhiá»u hÆ¡n CPU ráº¥t nhiá»u láº§n, vÃ¬ tháº¿ lÃ m cho GPU cÃ³ kháº£ nÄƒng tÃ­nh toÃ¡n cao hÆ¡n CPU.</p>
<p>ThÃªm má»™t hÃ¬nh áº£nh ná»¯a Ä‘á»ƒ so sÃ¡nh sá»± lá»£i háº¡i cá»§a GPU, náº¿u báº¡n cÃ³ má»™t mÃ¡y tÃ­nh cÃ³ vi xá»­ lÃ½ 4 nhÃ¢n thÃ¬ Ä‘Ã¢y lÃ  sá»± khÃ¡c biá»‡t Ä‘á»‘i vá»›i GPU:</p>
<p><img src="img/cpuvsgpu2.png" alt=""></p>
<p>NhÆ°ng náº¿u sá»­ dá»¥ng GPU lá»£i háº¡i nhÆ° váº­y thÃ¬ táº¡i sao ngÆ°á»i ta khÃ´ng dÃ¹ng GPU Ä‘á»ƒ thay tháº¿ CPU luÃ´n? CÃ¢u tráº£ lá»i lÃ  ráº¥t khÃ³, vÃ¬ viá»‡c debug trÃªn GPU khÃ´ng Ä‘Æ¡n giáº£n nhÆ° vá»›i CPU, thÃªm ná»¯a lÃ  GPU code cháº¡y song song (parallel) nÃªn cáº§n pháº£i cÃ³ cÃ¡c phÆ°Æ¡ng phÃ¡p Ä‘á»ƒ phÃ¢n vÃ¹ng dá»¯ liá»‡u, liÃªn láº¡c, Ä‘á»“ng bá»™ hÃ³a giá»¯a cÃ¡c core nÃªn cÃ¡c thuáº­t toÃ¡n xá»­ lÃ½ trÃªn GPU cá»±c kÃ¬ phá»©c táº¡p.</p>
<p>Äoáº¡n video sau Ä‘Ã¢y minh há»a sá»± khÃ¡c biá»‡t vá» viá»‡c dÃ¹ng CPU vÃ  GPU Ä‘á»ƒ váº½ hÃ¬nh áº£nh, con robot mÃ u vÃ ng lÃ  CPU cÃ²n cÃ¡i mÃ¡y bá»± chÃ  bÃ¡ kia lÃ  sá»©c máº¡nh thá»±c sá»± cá»§a má»™t GPU.</p>
<iframe width="700" height="400" src="https://www.youtube.com/embed/-P28LKWTzrI" frameborder="0" allowfullscreen></iframe>

<h3 id="gpu-ch-d-ng-l-m-h-a-">GPU chá»‰ dÃ¹ng lÃ m Ä‘á»“ há»a?</h3>
<p>Vá»›i sá»± phÃ¡t triá»ƒn cá»§a lÄ©nh vá»±c cÃ´ng nghá»‡ thÃ´ng tin hiá»‡n nay, nhá»¯ng cÃ´ng viá»‡c yÃªu cáº§u kháº£ nÄƒng tÃ­nh toÃ¡n cá»±c kÃ¬ cao Ä‘Ã£ báº¯t Ä‘áº§u cáº§n Ä‘áº¿n cÃ¡c há»‡ thá»‘ng mÃ¡y tÃ­nh cÃ³ kháº£ nÄƒng xá»­ lÃ½ máº¡nh hÆ¡n, vÃ  ngÆ°á»i ta Ä‘Ã£ báº¯t Ä‘áº§u tÃ¬m Ä‘áº¿n sá»± trá»£ giÃºp cá»§a cÃ¡c GPU trong cÃ´ng viá»‡c tÃ­nh toÃ¡n, khÃ´ng pháº£i chá»‰ riÃªng CPU ná»¯a.</p>
<p>Má»™t á»©ng dá»¥ng thá»±c táº¿ cÃ³ láº½ nhiá»u ngÆ°á»i biáº¿t Ä‘áº¿n nháº¥t Ä‘Ã³ lÃ  viá»‡c sá»­ dá»¥ng GPU Ä‘á»ƒ &quot;Ä‘Ã o&quot; Bitcoin.</p>
<p><img src="https://media.amazonwebservices.com/blog/2016/p2_cool_gpus_1.png" alt=""></p>
<p>Má»™t á»©ng dá»¥ng khÃ¡c thÆ°á»ng tháº¥y ná»¯a lÃ  trong ngÃ nh Machine Learning, ngÆ°á»i ta thÆ°á»ng sá»­ dá»¥ng GPU Ä‘á»ƒ gia tÄƒng tá»‘c Ä‘á»™ tÃ­nh toÃ¡n Ä‘á»‘i vá»›i cÃ¡c vector dá»¯ liá»‡u, vÃ¬ Ä‘Ã¢y cÅ©ng lÃ  má»™t ngÃ nh pháº£i xá»­ lÃ½ vá»›i lÆ°á»£ng dá»¯ liá»‡u cá»±c kÃ¬ lá»›n.</p>
<p>GÃ³i EC2 P2 cá»§a AWS cÅ©ng há»— trá»£ GPU <a href="https://aws.amazon.com/blogs/aws/new-p2-instance-type-for-amazon-ec2-up-to-16-gpus/">https://aws.amazon.com/blogs/aws/new-p2-instance-type-for-amazon-ec2-up-to-16-gpus/</a></p>
<h2 id="t-nh-to-n-v-i-gpu-b-ng-c-ch-n-o-">TÃ­nh toÃ¡n vá»›i GPU báº±ng cÃ¡ch nÃ o?</h2>
<p>CÃ³ ráº¥t nhiá»u cÃ¡ch Ä‘á»ƒ sá»­ dá»¥ng GPU lÃ m cÃ´ng cá»¥ tÃ­nh toÃ¡n, báº¡n cÃ³ thá»ƒ khá»Ÿi táº¡o má»™t á»©ng dá»¥ng Ä‘á»“ há»a, chuyá»ƒn Ä‘á»•i vector dá»¯ liá»‡u cáº§n tÃ­nh toÃ¡n thÃ nh cÃ¡c ma tráº­n texture rá»“i náº¡p vÃ o GPU, viáº¿t cÃ¡c Shader program (lÃ  má»™t dáº¡ng chÆ°Æ¡ng trÃ¬nh cháº¡y trÃªn GPU, trong quÃ¡ trÃ¬nh fragment processing cá»§a rendering pipeline) Ä‘á»ƒ tÃ­nh toÃ¡n vÃ  tráº£ dá»¯ liá»‡u vá» láº¡i CPU.</p>
<p>Tuy nhiÃªn cÃ¡ch lÃ m trÃªn khÃ¡ lÃ  phá»©c táº¡p vÃ  dÆ° thá»«a (pháº£i khá»Ÿi táº¡o mÃ´i trÆ°á»ng Ä‘á»“ há»a, khÃ´ng cáº§n thiáº¿t, vÃ  Ä‘Ã³ lÃ  cÃ¡ch lÃ m thá»§ cÃ´ng, khÃ´ng cÃ³ gÃ¬ Ä‘áº£m báº£o, vÃ  bá»‹ giá»›i háº¡n bá»Ÿi kháº£ nÄƒng cá»§a Shader program. </p>
<p>NgÃ y nay chÃºng ta cÃ³ cÃ¡c giáº£i phÃ¡p khÃ¡c, cÃ³ thá»ƒ nÃ³i lÃ  &quot;native&quot; hÆ¡n, Ä‘Ã³ lÃ  <strong>OpenCL</strong> vÃ  <strong>CUDA</strong>.</p>
<h3 id="cuda">CUDA</h3>
<p>Khi má»›i Ä‘Æ°á»£c ra máº¯t, <strong>CUDA</strong> lÃ  tÃªn viáº¿t táº¯t cá»§a <strong>Compute Unified Device Architecture</strong> tuy nhiÃªn vá» sau thÃ¬ Nvidia bá» háº³n tÃªn gá»i nÃ y.</p>
<p><strong>CUDA</strong> lÃ  má»™t ná»n táº£ng láº­p trÃ¬nh song song (parallel computing platform), cung cáº¥p cho chÃºng ta cÃ¡c API trÃªn cÃ¡c ngÃ´n ngá»¯ nhÆ° C/C++, Fortran, vÃ  vá» sau cÃ²n xuáº¥t hiá»‡n thÃªm cÃ¡c wrapper cho Java, Ruby, Python, Haskell... Ä‘á»ƒ giao tiáº¿p vá»›i cÃ¡c GPU cá»§a Nvidia vÃ  thá»±c hiá»‡n cÃ´ng viá»‡c tÃ­nh toÃ¡n giá»‘ng nhÆ° trÃªn CPU.</p>
<p>Quy trÃ¬nh hoáº¡t Ä‘á»™ng cá»§a má»™t á»©ng dá»¥ng CUDA khÃ¡ lÃ  giá»‘ng vá»›i rendering pipeline:</p>
<p><img src="img/cudaflow.png" alt=""></p>
<ol>
<li>Copy dá»¯ liá»‡u tá»« bá»™ nhá»› chÃ­nh vÃ o bá»™ nhá»› GPU</li>
<li>CPU chá»‰ thá»‹ cho GPU thá»±c hiá»‡n tÃ­nh toÃ¡n</li>
<li>GPU thá»±c hiá»‡n tÃ­nh toÃ¡n song song trÃªn cÃ¡c core cá»§a nÃ³</li>
<li>TÃ­nh xong GPU gá»­i tráº£ dá»¯ liá»‡u vá» láº¡i cho bá»™ nhá»› chÃ­nh</li>
</ol>
<p>CUDA cÃ³ má»™t vÃ i nhÆ°á»£c Ä‘iá»ƒm nháº¥t Ä‘á»‹nh, tuy nhiÃªn Ä‘iá»ƒm yáº¿u lá»›n nháº¥t cá»§a nÃ³ lÃ  Ä‘Æ°á»£c lÃ m ra bá»Ÿi Nvidia nÃªn chá»‰ há»— trá»£ cháº¡y trÃªn pháº§n cá»©ng cá»§a Nvidia, vÃ  khÃ´ng ai muá»‘n cÃ´ng nghá»‡ mÃ¬nh sá»­ dá»¥ng láº¡i bá»‹ phá»¥ thuá»™c vÃ o má»™t hÃ£ng sáº£n xuáº¥t nháº¥t Ä‘á»‹nh nÃ o háº¿t (trá»« trÆ°á»ng há»£p Apple =))) váº­y cho nÃªn ngÆ°á»i ta báº¯t Ä‘áº§u tÃ¬m Ä‘áº¿n má»™t giáº£i phÃ¡p tá»•ng quÃ¡t hÆ¡n, Ä‘Ã³ lÃ  <strong>OpenCL</strong></p>
<h3 id="opencl">OpenCL</h3>
<p><strong>Open Computing Language</strong> viáº¿t táº¯t lÃ  <strong>OpenCL</strong> lÃ  má»™t framework giÃºp cÃ¡c láº­p trÃ¬nh viÃªn phÃ¡t triá»ƒn cÃ¡c á»©ng dá»¥ng mÃ  chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ cháº¡y Ä‘Æ°á»£c trÃªn nhiá»u bá»™ xá»­ lÃ½ nhÆ° CPU, GPU, FPGA,...</p>
<p><img src="img/opencl.png" alt=""></p>
<p><strong>OpenCL</strong> lÃ  má»™t chuáº©n má»Ÿ Ä‘Æ°á»£c Apple táº¡o ra vÃ  trao quyá»n phÃ¡t triá»ƒn cho tá»• chá»©c Khronos Group trá»© danh (tá»• chá»©c Ä‘ang náº¯m quyá»n phÃ¡t triá»ƒn OpenGL). <strong>OpenCL</strong> Ä‘Æ°á»£c ráº¥t nhiá»u hÃ£ng pháº§n cá»©ng há»— trá»£ nhÆ° lÃ  AMD, Apple, ARM, IBM, Imagination Technologies, Intel, Nvidia, Qualcomm, Samsung,... Ä‘iá»u nÃ y khiáº¿n cho OpenCL trá»Ÿ thÃ nh má»™t tiÃªu chuáº©n chung cho cáº£ ngÃ nh cÃ´ng nghiá»‡p, giá»‘ng nhÆ° OpenGL váº­y.</p>
<p>VÃ  trong bÃ i viáº¿t nÃ y chÃºng ta sáº½ sá»­ dá»¥ng OpenCL Ä‘á»ƒ implement thuáº­t toÃ¡n nhÃ¢n ma tráº­n trÃªn GPU. Äá»ƒ cÃ³ thá»ƒ implement Ä‘Æ°á»£c thÃ¬ Ä‘áº§u tiÃªn pháº£i tÃ¬m hiá»ƒu rÃµ hÆ¡n vá» OpenCL vÃ  cÃ¡ch láº­p trÃ¬nh sá»­ dá»¥ng OpenCL.</p>
<h2 id="l-p-tr-nh-gpu-v-i-opencl">Láº­p trÃ¬nh GPU vá»›i OpenCL</h2>
<p>Äáº§u tiÃªn chÃºng ta cáº§n hiá»ƒu cÃ¡c khÃ¡i niá»‡m sá»­ dá»¥ng trong <strong>OpenCL</strong>.</p>
<h3 id="c-c-thu-t-ng-trong-opencl">CÃ¡c thuáº­t ngá»¯ trong OpenCL</h3>
<p>CÃ¡c thÃ nh pháº§n tham gia viá»‡c tÃ­nh toÃ¡n trong má»™t á»©ng dá»¥ng <strong>OpenCL</strong> lÃ  cÃ¡c <strong>Compute Device</strong>, gá»i lÃ  cÃ¡c thiáº¿t bá»‹ tÃ­nh toÃ¡n. VÃ  cÃ¡c thiáº¿t bá»‹ tÃ­nh toÃ¡n nÃ y cÃ³ thá»ƒ lÃ  cÃ¡c <strong>CPU</strong>, <strong>GPU</strong> hoáº·c cÃ¡c thiáº¿t bá»‹ khÃ¡c cÃ³ tÃ­nh nÄƒng tÆ°Æ¡ng tá»± bÃªn trong mÃ¡y tÃ­nh.</p>
<p><img src="img/computedevice.png" alt=""></p>
<p>Trong má»—i má»™t <strong>Compute Device</strong> chÃºng ta cÃ³ nhiá»u <strong>Compute Unit</strong>, lÃ  cÃ¡c core bÃªn trong nÃ³.</p>
<p><img src="img/computeunits.png" alt=""></p>
<p>VÃ  trong má»—i <strong>Compute Unit</strong> (core) ta cÃ³ nhiá»u <strong>Processing Element</strong> trá»±c tiáº¿p nháº­n lá»‡nh Ä‘á»ƒ tÃ­nh toÃ¡n.</p>
<h3 id="m-h-nh-l-m-vi-c-trong-opencl">MÃ´ hÃ¬nh lÃ m viá»‡c trong OpenCL</h3>
<p>MÃ´ hÃ¬nh xá»­ lÃ½ cá»§a <strong>OpenCL</strong> gá»“m cÃ³ má»™t chÆ°Æ¡ng trÃ¬nh <strong>Host</strong> cÃ³ nhiá»‡m vá»¥ Ä‘iá»u khiá»ƒn vÃ  liÃªn láº¡c vá»›i nhiá»u <strong>Compute Device</strong> theo sÆ¡ Ä‘á»“ sau:</p>
<p><img src="img/openclworkflow.png" alt=""></p>
<p>Khi thá»±c hiá»‡n xá»­ lÃ½, <strong>Host</strong> sáº½ khá»Ÿi táº¡o trÃªn má»—i <strong>Compute Device</strong> má»™t <strong>Context</strong> chá»©a cÃ¡c thÃ nh pháº§n nhÆ° lÃ : </p>
<ul>
<li>ThÃ´ng tin device Ä‘ang cháº¡y</li>
<li>Kernel (lÃ  Ä‘Æ¡n vá»‹ nhá» nháº¥t cá»§a quÃ¡ trÃ¬nh xá»­ lÃ½, nhÆ° lÃ  má»™t hÃ m)</li>
<li>Program Object (lÃ  Ä‘oáº¡n code implement cá»§a Kernel)</li>
<li>Command Queues (lÃ  queue cÃ¡c lá»‡nh Ä‘Æ°á»£c truyá»n vÃ o device tá»« host)</li>
<li>Memory Object (lÃ  Ä‘á»‘i tÆ°á»£ng chá»©a dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c truyá»n/nháº­n qua láº¡i giá»¯a device vÃ  host)</li>
</ul>
<p>Thao tÃ¡c copy dá»¯ liá»‡u tá»« <strong>Host</strong> tá»›i <strong>Compute Device</strong> gá»i lÃ  thao tÃ¡c <strong>ghi</strong> (writing), vÃ  thao tÃ¡c copy dá»¯ liá»‡u ngÆ°á»£c láº¡i tá»« <strong>Compute Device</strong> vá» <strong>Host</strong> gá»i lÃ  <strong>Ä‘á»c</strong> (reading).</p>
<p>ÄÃ¢y lÃ  flow cá»§a má»™t chÆ°Æ¡ng trÃ¬nh OpenCL thÆ°á»ng tháº¥y:</p>
<ul>
<li><strong>BÆ°á»›c 1:</strong> Chá»n device cáº§n dÃ¹ng (vÃ­ dá»¥ nhÆ°: ToÃ n bá»™ GPU)</li>
<li><strong>BÆ°á»›c 2:</strong> Khá»Ÿi táº¡o context</li>
<li><strong>BÆ°á»›c 3:</strong> Khá»Ÿi táº¡o Command Queue cho tá»«ng device</li>
<li><strong>BÆ°á»›c 4:</strong> BiÃªn dá»‹ch chÆ°Æ¡ng trÃ¬nh</li>
<li><strong>BÆ°á»›c 5:</strong> Táº¡o cÃ¡c kernel tá»« chÆ°Æ¡ng trÃ¬nh</li>
<li><strong>BÆ°á»›c 6:</strong> Cáº¥p phÃ¡t bá»™ nhá»› trÃªn tá»«ng device</li>
<li><strong>BÆ°á»›c 7:</strong> Ghi dá»¯ liá»‡u vÃ o memory object trÃªn device</li>
<li><strong>BÆ°á»›c 8:</strong> Thá»±c hiá»‡n xá»­ lÃ½ cÃ¡c kernel trÃªn device</li>
<li><strong>BÆ°á»›c 9:</strong> Gá»­i dá»¯ liá»‡u vá» láº¡i host</li>
<li><strong>BÆ°á»›c 10:</strong> Giáº£i phÃ³ng bá»™ nhá»› trÃªn device</li>
</ul>
<p>CÃ³ thá»ƒ tháº¥y mÃ´ hÃ¬nh trÃªn cÃ³ pháº§n phá»©c táº¡p hÆ¡n <strong>CUDA</strong>. NhÆ°ng lÃ m viá»‡c vá»›i <strong>OpenCL</strong> linh hoáº¡t hÆ¡n vÃ  khÃ´ng bá»‹ giá»›i háº¡n vá» máº·t thiáº¿t bá»‹ nhÆ° <strong>CUDA</strong>.</p>
<p>Viá»‡c khá»Ÿi Ä‘á»™ng má»™t <strong>kernel</strong> ráº¥t tá»‘n kÃ©m, vÃ¬ tháº¿ lá»i khuyÃªn Ä‘Æ°á»£c Ä‘Æ°a ra lÃ  nÃªn thiáº¿t káº¿ má»—i kernel lÃ m nhiá»u viá»‡c nháº¥t cÃ³ thá»ƒ.</p>
<h3 id="m-h-nh-qu-n-l-b-nh-c-a-opencl">MÃ´ hÃ¬nh quáº£n lÃ½ bá»™ nhá»› cá»§a OpenCL</h3>
<h2 id="implement-m-t-ch-ng-tr-nh-opencl-n-gi-n">Implement má»™t chÆ°Æ¡ng trÃ¬nh OpenCL Ä‘Æ¡n giáº£n</h2>
<p>Váº­y coi nhÆ° xong pháº§n lÃ½ thuyáº¿t, giá» chÃºng ta Ä‘i vÃ o pháº§n thá»±c hÃ nh cÆ¡ báº£n Ä‘á»ƒ hiá»ƒu kÄ© hÆ¡n vá» cÃ¡ch láº­p trÃ¬nh trÃªn GPU.</p>
<p>Äá» bÃ i sáº½ lÃ : <em>Implement chÆ°Æ¡ng trÃ¬nh tÃ­nh tá»•ng tá»« 0 Ä‘áº¿n 100 triá»‡u</em></p>
<h3 id="implement-tr-n-cpu">Implement trÃªn CPU</h3>
<p>Vá»›i cÃ¡ch nÃ y thÃ¬ khÃ´ng cÃ³ gÃ¬ Ä‘á»ƒ bÃ n rá»“i, Ä‘Æ¡n giáº£n chÃºng ta sáº½ implement má»™t vÃ²ng <code>for</code> rá»“i cho nÃ³ cháº¡y tá»« 0 Ä‘áº¿n 100 triá»‡u, cá»© tháº¿ mÃ  cá»™ng sá»‘ vÃ o.</p>
<pre><code>for (unsigned long long i = 0; i &lt; 100000000; i++) {
  val += i;
}
</code></pre><p>ChÃºng ta sáº½ thÃªm vÃ o má»™t Ä‘oáº¡n code Ä‘á»ƒ Ä‘o thá»i gian chÆ°Æ¡ng trÃ¬nh bá» ra Ä‘á»ƒ thá»±c hiá»‡n phÃ©p tÃ­nh trÃªn.</p>
<pre><code>clock_t begin = clock();

// Do something

clock_t end = clock();
double runtime = (double)(end - begin) / CLOCKS_PER_SEC;
</code></pre><p>HÃ m <code>clock()</code> láº¥y thá»i gian hiá»‡n táº¡i, cÃ³ trong thÆ° viá»‡n <code>time.h</code>, má»¥c Ä‘Ã­ch cá»§a Ä‘oáº¡n code trÃªn lÃ  láº¥y thá»i gian á»Ÿ vá»‹ trÃ­ báº¯t Ä‘áº§u xá»­ lÃ½, vÃ  thá»i gian á»Ÿ vá»‹ trÃ­ sau khi káº¿t thÃºc xá»­ lÃ½, trá»« 2 sá»‘ Ä‘Ã³ vá»›i nhau ta cÃ³ Ä‘Æ°á»£c thá»i gian cáº§n Ä‘á»ƒ cháº¡y chÆ°Æ¡ng trÃ¬nh.</p>
<p>Äoáº¡n implement Ä‘áº§y Ä‘á»§ sáº½ nhÆ° sau:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;time.h&gt;

typedef unsigned long long fuckin_large;

int main() {
  clock_t begin = clock();

  fuckin_large val = 0;
  for (fuckin_large j = 0; j &lt; 100000000; j++) {
    val += j;
  }
  printf(&quot;Result: %llu\n&quot;, val);

  clock_t end = clock();
  double runtime = (double)(end - begin) / CLOCKS_PER_SEC;
  printf(&quot;Runtime: %lfms\n&quot;, runtime);
}
</code></pre><p>Cháº¡y thá»­ chÆ°Æ¡ng trÃ¬nh trÃªn, output sáº½ cÃ³ dáº¡ng nhÆ° sau:</p>
<pre><code>Result: 4999999950000000
Runtime: 0.225600ms
</code></pre><p>DÃ²ng Ä‘áº§u lÃ  con sá»‘ káº¿t quáº£ sau khi Ä‘Ã£ tÃ­nh ra, dÃ²ng thá»© 2 cho biáº¿t thá»i gian cáº§n Ä‘á»ƒ thá»±c hiá»‡n chÆ°Æ¡ng trÃ¬nh. </p>
<p>MÃ¬nh cÃ³ cháº¡y thá»­ chÆ°Æ¡ng trÃ¬nh nÃ y trÃªn cÃ¡c mÃ¡y MacBook Pro tá»« 2012 tá»›i 2015, trung bÃ¬nh máº¥t táº§m <strong>0.2 mili giÃ¢y</strong> Ä‘á»ƒ tÃ­nh ra káº¿t quáº£.</p>
<p>Tiáº¿p theo hÃ£y thá»­ implement chÆ°Æ¡ng trÃ¬nh nÃ y vá»›i cÃ¡ch xá»­ lÃ½ tÆ°Æ¡ng tá»± nhÆ°ng cháº¡y trÃªn GPU xem tá»‘c Ä‘á»™ Ä‘Æ°á»£c cáº£i thiá»‡n nhÆ° tháº¿ nÃ o nhÃ©.</p>
<h3 id="implement-tr-n-gpu">Implement trÃªn GPU</h3>
<p>Äá»ƒ implement má»™t chÆ°Æ¡ng trÃ¬nh dÃ¹ng OpenCL thÃ¬ ta cáº§n implement 2 pháº§n: <strong>Host</strong> program vÃ  <strong>Kernel</strong> program.</p>
<p><img src="img/hostkernelsrc.png" alt=""></p>
<p><strong>Host</strong> lÃ  má»™t chÆ°Æ¡ng trÃ¬nh C/C++ cÃ³ nhiá»‡m vá»¥ Ä‘á»c file chÆ°Æ¡ng trÃ¬nh <strong>Kernel</strong> (Ä‘uÃ´i <code>*.cl</code>) vÃ  lÃ m cÃ¡c cÃ´ng viá»‡c khÃ¡c nhÆ° lÃ  khá»Ÿi táº¡o context, chá»n device, build program object, memory object, thá»±c thi kernel,... nhÆ° Ä‘Ã£ nÃ³i á»Ÿ pháº§n trÃªn.</p>
<h4 id="host-program">Host Program</h4>
<p><strong>BÆ°á»›c 1: Khá»Ÿi táº¡o</strong></p>
<p>Äáº§u tiÃªn <strong>Host</strong> cáº§n khá»Ÿi táº¡o cÃ¡c biáº¿n Ä‘á»ƒ chá»©a cÃ¡c Ä‘á»‘i tÆ°á»£ng cáº§n thiáº¿t nhÆ° lÃ  <strong>Device</strong>, <strong>Context</strong>, <strong>Command Queue</strong>,...:</p>
<pre><code>cl_device_id device_id          = NULL;
cl_context context              = NULL;
cl_command_queue command_queue  = NULL;
cl_mem memobj                   = NULL;
cl_program program              = NULL;
cl_kernel kernel                = NULL;
cl_platform_id platform_id      = NULL;
cl_uint ret_num_devices;
cl_uint ret_num_platforms;
cl_int ret;
</code></pre><p><strong>BÆ°á»›c 2: Äá»c Kernel Source</strong></p>
<p>Tiáº¿p theo chÃºng ta Ä‘á»c file <strong>Kernel</strong> source vÃ  lÆ°u vÃ o má»™t file pointer:</p>
<pre><code>FILE *fp;
char fileName[]   = &quot;./sum.cl&quot;;
char *source_str;
size_t source_size;

fp = fopen(fileName, &quot;r&quot;);
if (!fp) {
  fprintf(stderr, &quot;Failed to load kernel\n&quot;);
  exit(1);
}
source_str  = (char*)malloc(MAX_SOURCE_SIZE);
source_size = fread(source_str, 1, MAX_SOURCE_SIZE, fp);
fclose(fp);
</code></pre><p>Trong vÃ­ dá»¥ nÃ y thÃ¬ file <strong>Kernel</strong> cá»§a chÃºng ta lÃ  <code>sum.cl</code></p>
<p><strong>BÆ°á»›c 3: Khá»Ÿi táº¡o Context vÃ  cÃ¡c thÃ nh pháº§n liÃªn quan</strong></p>
<p>Sau khi Ä‘Ã£ cÃ³ source code cá»§a <strong>Kernel</strong>, ta tiáº¿n hÃ nh chá»n device vÃ  khá»Ÿi táº¡o context, biÃªn dá»‹ch source code cá»§a kernel thÃ nh <strong>Program Object</strong> </p>
<pre><code>ret = clGetPlatformIDs(1, &amp;platform_id, &amp;ret_num_platforms);
ret = clGetDeviceIDs(platform_id, CL_DEVICE_TYPE_DEFAULT, 1, &amp;device_id, &amp;ret_num_devices);

context       = clCreateContext(NULL, 1, &amp;device_id, NULL, NULL, &amp;ret);
command_queue = clCreateCommandQueue(context, device_id, 0, &amp;ret);
program       = clCreateProgramWithSource(context, 1, 
                                         (const char **)&amp;source_str, 
                                         (const size_t *)&amp;source_size, 
                                         &amp;ret);
ret           = clBuildProgram(program, 1, &amp;device_id, 
                                           NULL, NULL, NULL);
kernel        = clCreateKernel(program, &quot;hello&quot;, &amp;ret);
</code></pre><p><strong>BÆ°á»›c 4: Cáº¥p phÃ¡t bá»™ nhá»› trÃªn Compute Device</strong></p>
<p>Sau Ä‘Ã³ cáº¥p phÃ¡t bá»™ nhá»› cho Compute Device trong Context thÃ´ng qua hÃ m <code>clCreateBuffer</code> vÃ  <code>clSetKernelArg</code> Ä‘á»ƒ chá»‰ Ä‘á»‹nh vÃ¹ng nhá»› nÃ y tÆ°Æ¡ng á»©ng vá»›i tham sá»‘ nÃ o khi truyá»n vÃ o kernel.</p>
<pre><code>memobj = clCreateBuffer(context, CL_MEM_READ_WRITE, 
                        sizeof(cl_mem), NULL, &amp;ret);
ret = clSetKernelArg(kernel, 0, sizeof(cl_mem), (void*)&amp;memobj);
</code></pre><p>NgoÃ i ra, chÃºng ta cÃ³ thá»ƒ truyá»n giÃ¡ trá»‹ vÃ o cho cÃ¡c tham sá»‘ thÃ´ng qua hÃ m <code>clEnqueueWriteBuffer</code>:</p>
<pre><code>ret = clEnqueueWriteBuffer(command_queue, memobj_A, CL_TRUE, 0, MATRIX_SIZE * MATRIX_SIZE * sizeof(cl_mem), A, 0, NULL, NULL);
</code></pre><p><strong>BÆ°á»›c 5: Cháº¡y Kernel vÃ  Äá»c káº¿t quáº£</strong></p>
<p>Äáº¿n bÆ°á»›c nÃ y chÃºng ta sá»­ dá»¥ng hÃ m <code>clEnqueueTask</code> Ä‘á»ƒ gÃ¡n <strong>Command Queue</strong> Ä‘Ã£ táº¡o vÃ o cho <strong>Kernel</strong>. Sau khi Ä‘Æ°á»£c gÃ¡n thÃ¬ <strong>Kernel</strong> sáº½ khá»Ÿi Ä‘á»™ng vÃ  báº¯t Ä‘áº§u xá»­ lÃ½ trÃªn cÃ¡c <strong>Processing Elements</strong> trÃªn <strong>Compute Device</strong> (á»Ÿ Ä‘Ã¢y cÃ³ thá»ƒ lÃ  GPU cá»§a chÃºng ta).</p>
<pre><code>ret = clEnqueueTask(command_queue, kernel, 0, NULL, NULL);
</code></pre><p>Äá»ƒ láº¥y dá»¯ liá»‡u ra sau khi <strong>Kernel</strong> hoÃ n thÃ nh viá»‡c tÃ­nh toÃ¡n, chÃºng ta dÃ¹ng hÃ m <code>clEnqueueReadBuffer</code>:</p>
<pre><code>ret = clEnqueueReadBuffer(command_queue, memobj, CL_TRUE, 0, sizeof(cl_mem), val, 0, NULL, NULL);
</code></pre><p>GiÃ¡ trá»‹ <code>CL_TRUE</code> truyá»n vÃ o hÃ m nÃ y lÃ  cho tham sá»‘ <code>cl_bool blocking_read</code>, tham sá»‘ nÃ y cho biáº¿t hÃ m <code>clEnqueueReadBuffer</code> sáº½ block khÃ´ng cho <strong>Host</strong> program thá»±c hiá»‡n tiáº¿p cho Ä‘áº¿n khi nÃ³ nháº­n Ä‘Æ°á»£c giÃ¡ trá»‹ tráº£ vá» sau khi <strong>Kernel</strong> hoÃ n thÃ nh.</p>
<p>ÄÃ¢y cÅ©ng lÃ  bÆ°á»›c mÃ  chÃºng ta cáº§n sá»­ dá»¥ng hÃ m <code>clock()</code> Ä‘á»ƒ tÃ­nh toÃ¡n thá»i gian xá»­ lÃ½ cá»§a <strong>Kernel</strong>.</p>
<pre><code>clock_t begin = clock();

// Do something

clock_t end = clock();
double runtime = (double)(end - begin) / CLOCKS_PER_SEC;
</code></pre><p><strong>BÆ°á»›c 6: Giáº£i phÃ³ng bá»™ nhá»›</strong></p>
<p>Káº¿t thÃºc chÆ°Æ¡ng trÃ¬nh, chÃºng ta giáº£i phÃ³ng táº¥t cáº£ cÃ¡c Ä‘á»‘i tÆ°á»£ng Ä‘Ã£ táº¡o ra Ä‘á»ƒ trÃ¡nh bá»‹ memory leak.</p>
<pre><code>ret = clFlush(command_queue);
ret = clFinish(command_queue);
ret = clReleaseKernel(kernel);
ret = clReleaseProgram(program);
ret = clReleaseMemObject(memobj);
ret = clReleaseCommandQueue(command_queue);
ret = clReleaseContext(context);

free(source_str);
</code></pre><p>ÄÃ¢y lÃ  Ä‘oáº¡n code implement Ä‘áº§y Ä‘á»§ cá»§a <strong>Host</strong> program lÃ m cÃ´ng viá»‡c tÃ­nh tá»•ng theo Ä‘á» bÃ i Ä‘Ã£ cho:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;OpenCL/opencl.h&gt;
#include &lt;time.h&gt;

#define MAX_SOURCE_SIZE (0x100000)

int main() {
  cl_device_id device_id = NULL;
  cl_context context = NULL;
  cl_command_queue command_queue = NULL;
  cl_mem memobj = NULL;
  cl_program program = NULL;
  cl_kernel kernel = NULL;
  cl_platform_id platform_id = NULL;
  cl_uint ret_num_devices;
  cl_uint ret_num_platforms;
  cl_int ret;

  cl_ulong val[1];

  FILE *fp;
  char fileName[] = &quot;./sum.cl&quot;;
  char *source_str;
  size_t source_size;

  fp = fopen(fileName, &quot;r&quot;);
  if (!fp) {
    fprintf(stderr, &quot;Failed to load kernel\n&quot;);
    exit(1);
  }
  source_str = (char*)malloc(MAX_SOURCE_SIZE);
  source_size = fread(source_str, 1, MAX_SOURCE_SIZE, fp);
  fclose(fp);

  ret = clGetPlatformIDs(1, &amp;platform_id, &amp;ret_num_platforms);
  ret = clGetDeviceIDs(platform_id, CL_DEVICE_TYPE_DEFAULT, 1, &amp;device_id, &amp;ret_num_devices);

  context = clCreateContext(NULL, 1, &amp;device_id, NULL, NULL, &amp;ret);
  command_queue = clCreateCommandQueue(context, device_id, 0, &amp;ret);
  memobj = clCreateBuffer(context, CL_MEM_READ_WRITE, sizeof(cl_mem), NULL, &amp;ret);
  program = clCreateProgramWithSource(context, 1, (const char **)&amp;source_str, (const size_t *)&amp;source_size, &amp;ret);
  ret = clBuildProgram(program, 1, &amp;device_id, NULL, NULL, NULL);
  kernel = clCreateKernel(program, &quot;hello&quot;, &amp;ret);

  ret = clSetKernelArg(kernel, 0, sizeof(cl_mem), (void*)&amp;memobj);

  clock_t begin = clock();

  ret = clEnqueueTask(command_queue, kernel, 0, NULL, NULL);

  ret = clEnqueueReadBuffer(command_queue, memobj, CL_TRUE, 0, sizeof(cl_mem), val, 0, NULL, NULL);

  clock_t end = clock();
  double runtime = (double)(end - begin) / CLOCKS_PER_SEC;

  ret = clFlush(command_queue);
  ret = clFinish(command_queue);
  ret = clReleaseKernel(kernel);
  ret = clReleaseProgram(program);
  ret = clReleaseMemObject(memobj);
  ret = clReleaseCommandQueue(command_queue);
  ret = clReleaseContext(context);

  printf(&quot;Result: %llu\n&quot;, val[0]);
  printf(&quot;Runtime: %lfms\n&quot;, runtime);

  free(source_str);

  return 0;
}
</code></pre><h4 id="kernel-program">Kernel Program</h4>
<p>Tiáº¿p Ä‘áº¿n chÃºng ta implement <strong>Kernel</strong>, Ä‘Ã¢y lÃ  Ä‘oáº¡n chÆ°Æ¡ng trÃ¬nh sáº½ Ä‘Æ°á»£c <strong>Host</strong> náº¡p vÃ o <strong>Program Object</strong> Ä‘á»ƒ thá»±c hiá»‡n xá»­ lÃ½ trÃªn GPU.</p>
<p>ChÆ°Æ¡ng trÃ¬nh nÃ y sáº½ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a báº±ng cÃ¡c tá»« khÃ³a <code>kernel</code>. Ta truyá»n vÃ o má»™t biáº¿n con trá» Ä‘á»ƒ tiáº¿p nháº­n dá»¯ liá»‡u Ä‘áº§u ra, chÆ°Æ¡ng trÃ¬nh nÃ y sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p tÃ­nh báº±ng cÃ¡ch cháº¡y má»™t vÃ²ng láº·p for, cÃ³ thá»ƒ implement nhÆ° sau:</p>
<pre><code>kernel void hello(global ulong *val) {
  size_t i = get_global_id(0);
  for (ulong j = 0; j &lt; 100000000; j++) {
    val[i] += j;
  }
}
</code></pre><p>Biáº¿n <code>i</code> trong chÆ°Æ¡ng trÃ¬nh trÃªn lÃ  id cá»§a tiáº¿n trÃ¬nh kernel Ä‘Æ°á»£c khá»Ÿi táº¡o trong lÃºc thá»±c thi, chÃºng ta cáº§n pháº£i láº¥y chÃ­nh xÃ¡c id nÃ y Ä‘á»ƒ gá»­i tráº£ dá»¯ liá»‡u vá» cho <strong>Host</strong>.</p>
<p>Äáº·c Ä‘iá»ƒm cá»§a kernel lÃ  cÃ¡c biáº¿n, tham sá»‘ truyá»n vÃ o Ä‘á»u mutable vÃ  chÃºng ta khÃ´ng cáº§n return dá»¯ liá»‡u (vÃ¬ á»Ÿ host Ä‘Ã£ cÃ³ má»™t bÆ°á»›c Ä‘á»c dá»¯ liá»‡u tá»« memory object ra rá»“i).</p>
<h2 id="implement-thu-t-to-n-nh-n-ma-tr-n-tr-n-gpu">Implement thuáº­t toÃ¡n nhÃ¢n ma tráº­n trÃªn GPU</h2>
<p>(Coming soon...)</p>
<div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='https://huytd.github.io/tags/algorithm.html'>algorithm</a><a class='topic-tag' href='https://huytd.github.io/tags/math.html'>math</a><a class='topic-tag' href='https://huytd.github.io/tags/gpu.html'>gpu</a></div>
                <div class="copyright">
                Báº¡n Ä‘Æ°á»£c tÃ¹y Ã½ báº¥m like, trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n vÃ  tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, mÃ¬nh hy vá»ng tá»« nay vá» sau báº¡n sáº½ luÃ´n cáº£m tháº¥y cáº¯n rá»©t lÆ°Æ¡ng tÃ¢m, Äƒn khÃ´ng ngon, ngá»§ khÃ´ng yÃªn. ğŸ˜†
                </div>
            </div>
        </div>
	    <div class="footer">
            <p>Created with <a href="http://github.com/huytd/azeroth-js">azeroth.js</a></p>
            <div class="social">
                <a target="_blank" href="http://facebook.com/kingbazoka"><i class="icon-facebook-squared"></i></a>
                <a target="_blank" href="http://twitter.com/huydotnet"><i class="icon-twitter-squared"></i></a>
                <a target="_blank" href="http://github.com/huytd"><i class="icon-github-squared"></i></a>
                <a target="_blank" href="https://thefullsnack.com"><i class="icon-emo-coffee"></i></a>
            </div>
        </div>
        <script type="text/javascript" async src="https://cdn.rawgit.com/mathjax/MathJax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea"]
          }
        });
        </script>
    </body>
</html>

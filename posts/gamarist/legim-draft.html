<html>
    <head>
        <title> Legim Draft | Huy's Blog</title>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
        
        <link href="../../css/inconsolata.css" rel="stylesheet" type="text/css">
        <link href="../../css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../../css/highlight/tomorrow.css">
        <link rel="stylesheet" href="../../css/fontello.css">
        <script src="../../js/highlight.pack.js"></script>
        <script>
        hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="header">
            <a href="/"><i class="icon icon-emo-coffee"></i> Huy's Blog</a>
        </div>
        <div class="container">
            <div class="main">
                <h1 id="legim-draft">Legim Draft</h1>
<p><strong>Legim</strong> cÃ³ nghÄ©a lÃ  <strong>LEGO Image Server</strong>, mang Ã½ nghÄ©a lÃ  má»™t app server áº£nh cÃ³ kháº£ nÄƒng hoáº¡t Ä‘á»™ng Ä‘á»™c láº­p hoáº·c cÃ³ thá»ƒ ghÃ©p ná»‘i láº¡i má»™t cÃ¡ch dá»… dÃ ng Ä‘á»ƒ táº¡o thÃ nh má»™t há»‡ thá»‘ng má»™t cÃ¡ch dá»… dÃ ng giá»‘ng nhÆ° trÃ² chÆ¡i LEGO.</p>
<h2 id="t-ng-quan-h-th-ng">Tá»•ng quan há»‡ thÃ´ng</h2>
<p>Má»™t cÃ¡ch tá»•ng quÃ¡t, cáº¥u trÃºc hoáº¡t Ä‘á»™ng cá»§a <strong>Legim</strong> nhÆ° hÃ¬nh sau:</p>
<p><img src="../img/legim_01.PNG" alt=""></p>
<p>Trong Ä‘Ã³, server application lÃ  chÆ°Æ¡ng trÃ¬nh chÃ­nh, sáº½ káº¿t ná»•i vÃ  quáº£n lÃ½ cÃ¡c file hÃ¬nh áº£nh náº±m trÃªn Ä‘Ä©a cá»©ng, Ä‘á»“ng thá»i cung cáº¥p RESTful API Ä‘á»ƒ user cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c (upload hÃ¬nh áº£nh, download hÃ¬nh áº£nh,...)</p>
<h2 id="m-t-node-server">Má»™t node server</h2>
<p>Node á»Ÿ Ä‘Ã¢y gá»i lÃ  má»™t nÃºt, má»™t khá»‘i gá»“m cÃ³: Server app vÃ  ÄÄ©a cá»©ng cáº¥u thÃ nh má»™t node trÃªn há»‡ thá»‘ng.</p>
<p><img src="../img/legim_02.PNG" alt=""></p>
<p>VÃ  Ä‘Ã¢y cÅ©ng lÃ  Ä‘Æ¡n vá»‹ cÆ¡ báº£n nháº¥t cá»§a há»‡ thá»‘ng.</p>
<p>CÃ³ 3 loáº¡i node tá»“n táº¡i trong há»‡ thá»‘ng, nhÆ° hÃ¬nh sau:</p>
<p><img src="../img/legim_03.PNG" alt=""></p>
<h3 id="gateway-node">Gateway Node</h3>
<p>CÃ¡c node khÃ´ng cÃ³ <strong>node cha</strong> (parent node) sáº½ Ä‘Æ°á»£c hiá»ƒu máº·c Ä‘á»‹nh lÃ  cÃ¡c <strong>Gateway</strong>.</p>
<p>Trong má»™t há»‡ thá»‘ng Legim thÃ¬ chá»‰ cÃ³ <strong>Gateway</strong> node lÃ  cÃ³ thá»ƒ cung cáº¥p REST API Ä‘á»ƒ giao tiáº¿p vá»›i user.</p>
<p>Máº·c Ä‘á»‹nh khi khá»Ÿi táº¡o má»™t server chá»‰ gá»“m má»™t Legim node, thÃ¬ node nÃ y sáº½ Ä‘Æ°á»£c nháº­n diá»‡n lÃ  <strong>Gateway</strong>.</p>
<h3 id="cluster-node-v-leaf-node">Cluster Node vÃ  Leaf Node</h3>
<p>CÃ¡c node con cá»§a <strong>gateway</strong> node cÃ³ thá»ƒ lÃ  <strong>Leaf Node</strong> (node lÃ¡), lÃ  cÃ¡c node khÃ´ng cÃ³ node con hoáº·c cÃ¡c <strong>Cluster Node</strong> (lÃ  cÃ¡c node cÃ³ chá»©a cÃ¡c node lÃ¡ bÃªn trong).</p>
<p>Cluster Node vÃ  Leaf Node sáº½ khÃ´ng Ä‘Æ°á»£c quyá»n cung cáº¥p REST API.</p>
<p>CÃ¡c Cluster node sáº½ káº¿t ná»‘i trá»±c tiáº¿p tá»›i Gateway.</p>
<p>CÃ¡c Leaf Node sáº½ káº¿t ná»‘i trá»±c tiáº¿p tá»›i Cluster Node.</p>
<p>Má»™t node cÃ³ thá»ƒ chá»©a khÃ´ng, má»™t hoáº·c nhiá»u (hoáº·c ráº¥t nhiá»u) node con, vÃ  táº¥t cáº£ sáº½ táº¡o thÃ nh má»™t Ä‘á»“ thá»‹ hÃ¬nh cÃ¢y.</p>
<p>Khi má»™t node lÃ¡ Ä‘Æ°á»£c táº¡o ra, thÃ¬ nÃ³ pháº£i Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh Ä‘á»‹a chá»‰ cá»§a node cha cáº§n káº¿t ná»‘i Ä‘áº¿n.</p>
<h2 id="h-th-ng-h-nh-c-y">Há»‡ thá»‘ng hÃ¬nh cÃ¢y</h2>
<p>Dá»±a vÃ o cáº¥u trÃºc hÃ¬nh cÃ¢y, chÃºng ta cÃ³ thá»ƒ táº¡o ra má»™t há»‡ thá»‘ng gá»“m má»™t gateway node á»Ÿ trung tÃ¢m, vÃ  ráº¥t nhiá»u node con phÃ¢n bá»‘ kháº¯p nÆ¡i (vá» máº·t Ä‘á»‹a lÃ½) nhÆ° hÃ¬nh sau: </p>
<p><img src="../img/legim_04.PNG" alt=""></p>
<p>CÃ¡c cluster cÃ³ thá»ƒ Ä‘Æ°á»£c táº¡o ra á»Ÿ nhiá»u Ä‘á»‹a Ä‘iá»ƒm trÃªn tháº¿ giá»›i Ä‘á»ƒ Ä‘áº£m báº£o tá»‘i Æ°u vá» máº·t phá»¥c vá»¥.</p>
<h2 id="c-ch-tr-o-ng-c-gi-p-backup-d-li-u">CÆ¡ cháº¿ &quot;trÃ o ngÆ°á»£c&quot; giÃºp backup dá»¯ liá»‡u</h2>
<p>Giáº£ sá»­ ta cÃ³ má»™t há»‡ thá»‘ng vá»›i cÃ¡c file <code>A, B, C, D, E</code> Ä‘Æ°á»£c phÃ¢n bá»‘ nhÆ° hÃ­nh sau:</p>
<p><img src="../img/legim_05.PNG" alt=""></p>
<p>Khi má»™t node bá»‹ táº¯t Ä‘i, há»‡ thá»‘ng sáº½ tiáº¿n hÃ nh táº¯t toÃ n bá»™ cÃ¡c node con cá»§a nÃ³ sáº½ bá»‹ táº¯t trÆ°á»›c, sau Ä‘Ã³ má»›i Ä‘áº¿n chÃ­nh node Ä‘Ã³ bá»‹ táº¯t.</p>
<p>Trong quÃ¡ trÃ¬nh táº¯t node, há»‡ thá»‘ng sáº½ tiáº¿n hÃ nh &quot;trÃ o ngÆ°á»£c&quot; (phun ngÆ°á»£c =))) dá»¯ liá»‡u tá»« node bá»‹ táº¯t lÃªn node cao hÆ¡n (node cha), nhÆ° hÃ¬nh sau:</p>
<p><img src="../img/legim_07.PNG" alt=""></p>
<p>Node <code>San Francisco</code> bá»‹ táº¯t Ä‘i, file <code>E</code> cá»§a node nÃ y sáº½ Ä‘Æ°á»£c chuyá»ƒn lÃªn node <code>USA</code>. Náº¿u cáº§n thiáº¿t, node <code>USA</code> cÃ³ thá»ƒ chuyá»ƒn file <code>E</code> vá» cÃ¡c node <code>Chicago</code> hoáº·c <code>Florida</code> Ä‘á»ƒ giáº£m táº£i.</p>
<h2 id="load-balancing">Load balancing</h2>
<p>Khi má»™t user request má»™t hÃ¬nh áº£nh, request sáº½ Ä‘i qua REST API vÃ  Ä‘i vÃ o Gateway server, táº¡i Ä‘Ã¢y, request sáº½ Ä‘Æ°á»£c phÃ¢n phá»‘i vá» server nÃ o cÃ³ chá»©a hÃ¬nh áº£nh cáº§n load vÃ  cÃ³ Ä‘á»™ trá»… (latency) tháº¥p nháº¥t (Ä‘á»ƒ Ä‘áº£m báº£o tá»‘c Ä‘á»™), thÆ°á»ng lÃ  server náº±m gáº§n nháº¥t.</p>
<p>VÃ­ dá»¥ hÃ¬nh sau, má»™t user tá»« ÄÃ  Náºµng cÃ³ thá»ƒ request tá»›i há»‡ thá»‘ng vÃ  nháº­n Ä‘Æ°á»£c file náº±m táº¡i server HÃ  Ná»™i, cÃ²n má»™t user tá»« San Jose cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c file tá»« server San Francisco.</p>
<p><img src="../img/legim_06.PNG" alt=""></p>
<h2 id="scaling">Scaling</h2>
<p>Legim Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ giÃºp cho viá»‡c scaling diá»…n ra má»™t cÃ¡ch it tá»‘n kÃ©m nháº¥t. </p>
<p>Khi cáº§n loáº¡i bá»›t server, chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng thá»±c hiá»‡n báº±ng cÃ¡ch táº¯t bá»›t cÃ¡c leaf node hoáº·c cáº£ má»™t cá»¥m cluster. CÆ¡ cháº¿ backup dá»¯ liá»‡u theo kiá»ƒu &quot;trÃ o ngÆ°á»£c&quot; (dá»¯ liá»‡u tá»« node con sáº½ Ä‘i háº¿t lÃªn node cha trÆ°á»›c khi node con bá»‹ táº¯t) sáº½ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u.</p>
<p>Khi cáº§n thÃªm vÃ o má»™t server, chÃºng ta chá»‰ cáº§n khá»Ÿi Ä‘á»™ng legim trÃªn má»™t mÃ¡y tÃ­nh má»›i, vÃ  chá»‰ Ä‘á»‹nh file config cho server má»›i cÃ³ dáº¡ng nhÆ° sau:</p>
<pre><code>node:
  port: 8888

parent:
  ip: 10.0.0.6
  port: 3333
</code></pre><p>Trong Ä‘Ã³, mÃ¡y tÃ­nh á»Ÿ Ä‘á»‹a chá»‰ <code>10.0.0.6:3333</code> lÃ  server cha cáº§n káº¿t ná»‘i tá»›i, vÃ  server hiá»‡n táº¡i cháº¡y trÃªn cá»•ng <code>8888</code>.</p>

                <div class="copyright">
                Báº¡n Ä‘Æ°á»£c tÃ¹y Ã½ báº¥m like, trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n vÃ  tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, mÃ¬nh hy vá»ng tá»« nay vá» sau báº¡n sáº½ luÃ´n cáº£m tháº¥y cáº¯n rá»©t lÆ°Æ¡ng tÃ¢m, Äƒn khÃ´ng ngon, ngá»§ khÃ´ng yÃªn. ğŸ˜†
                </div>
            </div>
        </div>
	    <div class="footer">
            <p>Created with <a href="http://github.com/huytd/azeroth-js">azeroth.js</a></p>
            <div class="social">
                <a target="_blank" href="http://facebook.com/kingbazoka"><i class="icon-facebook-squared"></i></a>
                <a target="_blank" href="http://twitter.com/huydotnet"><i class="icon-twitter-squared"></i></a>
                <a target="_blank" href="http://github.com/huytd"><i class="icon-github-squared"></i></a>
                <a target="_blank" href="https://thefullsnack.com"><i class="icon-emo-coffee"></i></a>
            </div>
        </div>
        <script type="text/javascript" async src="https://cdn.rawgit.com/mathjax/MathJax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea"]
          }
        });
        </script>
    </body>
</html>

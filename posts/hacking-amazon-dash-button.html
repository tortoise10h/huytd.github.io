<html>
    <head>
        <title> Hacking Amazon Dash Button | Huy's Blog</title>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
        
        <link href="../css/inconsolata.css" rel="stylesheet" type="text/css">
        <link href="../css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../css/highlight/tomorrow.css">
        <link rel="stylesheet" href="../css/fontello.css">
        <script src="../js/highlight.pack.js"></script>
        <script>
        hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="header">
            <a href="/"><i class="icon icon-emo-coffee"></i> Huy's Blog</a>
        </div>
        <div class="container">
            <div class="main">
                <h1 id="hacking-amazon-dash-button">Hacking Amazon Dash Button</h1>
<p>Amazon Dash Button lÃ  má»™t thiáº¿t bá»‹ káº¿t ná»‘i Wifi vÃ  chá»‰ cÃ³ 1 nÃºt báº¥m. Sau khi mua vá» vÃ  cÃ i Ä‘áº·t xong, thÃ¬ khi báº¥m cÃ¡i nÃºt nÃ y, nÃ³ sáº½ tá»± Ä‘á»™ng gá»­i request Ä‘áº¿n Amazon Ä‘á»ƒ order mÃ³n Ä‘á»“ mÃ  báº¡n Ä‘Ã£ chá»n trÆ°Ã³c Ä‘Ã³. </p>
<p>Báº¡n cÃ³ thá»ƒ dÃ¹ng nÃ³ Ä‘á»ƒ order mÃ¬ tÃ´m, bÃ¡nh káº¹o, sá»¯a, bá»™t giáº·t, cÃ  phÃª, hay báº¥t cá»© thá»© gÃ¬ tÃ¹y thÃ­ch. Tuy nhiÃªn báº¡n chá»‰ Ä‘Æ°á»c order nhá»¯ng máº·t hÃ ng cá»§a má»™t hÃ£ng cho má»™t nÃºt, tÃ¹y theo nhÃ£n in trÃªn nÃºt Ä‘Ã³.</p>
<p><img src="img/dashbutton.jpg" alt=""></p>
<div style="text-align: center;" class="copyright">HÃ¬nh áº£nh bá»£ tá»« blog <a href="https://mpetroff.net/2015/05/amazon-dash-button-teardown/">Matthew Petroff: Amazon Dash Button Teardown</a></div>

<h2 id="c-u-h-nh-b-n-trong">Cáº¥u hÃ¬nh bÃªn trong</h2>
<p>Tuy bá» ngoÃ i nhÃ¬n khÃ¡ lÃ  Ä‘Æ¡n giáº£n, nhÆ°ng bÃªn trong Dash button cÃ³ ráº¥t nhiá»u thá»© hay ho:</p>
<ul>
<li>DÃ¹ng chip xá»­ lÃ½ <code>ARM Cortex-M3</code> (STM32F205RG6), xung nhá»‹p lÃªn Ä‘áº¿n <code>120 MHz</code>.</li>
<li>Chip nÃ y cÃ³ <code>128 KB</code> RAM vÃ  <code>1 MB</code> bá»™ nhá»› flash Ä‘á»ƒ chá»©a chÆ°ong trÃ¬nh Ä‘iá»u khiá»ƒn.</li>
<li>Chip nÃ y cÃ²n tÃ­ch há»£p luÃ´n module WIFI <code>BCM943362</code>.</li>
<li>CÃ³ 1 microphone tÃ­ch há»£p.</li>
<li>CÃ³ 1 Ä‘Ã¨n LED RGB.</li>
<li>Cáº¥p nguá»“n báº±ng 1 cá»¥c pin <code>Energizer Ultimate Lithium AAA</code> cÃ³ tá»­u lÆ°á»ng... nháº§m, thá»i lÆ°á»ng lÃªn Ä‘áº¿n 20 nÄƒm</li>
</ul>
<p>VÃ  táº¥t nhiÃªn vá»›i kháº£ nÄƒng káº¿t ná»‘i wifi cÃ¹ng thá»i lÆ°á»ng pin trÃ¢u bÃ² cá»§a nÃ³, thÃ¬ viá»‡c dÃ¹ng nÃ³ Ä‘á»ƒ lÃ m cÃ¡i nÃºt order bá»‰m sá»­a cÃ³ váº» hÆ¡i bá»‹ phÃ­. ChÆ°a ká»ƒ lÃ  Ä‘Æ°á»£c bÃ¡n vá»›i giÃ¡ ráº» bÃ¨o nhÆ° cho khÃ´ng (tá»« <code>0.99$</code> - <code>4.99$</code>) thÃ¬ Ä‘Ã¢y quáº£ lÃ  má»™t mÃ³n Ä‘á»“ chÆ¡i lÃ½ tÆ°á»Ÿng cho dÃ¢n ghiá»n cÃ´ng nghá»‡.</p>
<p>ChÆ°a háº¿t, sau khi mua 1 em Dash nÃ y vá», thÃ¬ báº¡n sáº½ Ä‘Æ°á»£c giáº£m giÃ¡ ngay 4.99$ cho order Ä‘áº§u tiÃªn. VÃ¬ báº¡n Evan nhÃ  mÃ¬nh chuáº©n bá»‹ má»c rÄƒng, ráº¥t thÃ­ch nhai báº¥t cá»© thá»© gÃ¬ báº¡n áº¥y vá»› Ä‘Æ°á»£c nÃªn hÃ´m qua mÃ¬nh order má»™t cá»¥c chew toy giÃ¡ <code>5$</code> vÃ  Ä‘Æ°á»c giáº£m giÃ¡ ngay láº­p tá»©c, dÃ¹ lÃ  cÃ¡i Dash button mua chá»‰ cÃ³ <code>0.99$</code> :))</p>
<p>Giá» vÃ´ chá»§ Ä‘á» chÃ­nh: <strong>Hack cÃ¡i nÃºt Dash button</strong>.</p>
<h2 id="hacking">Hacking</h2>
<p>MÃ´ hÃ¬nh hoáº¡t Ä‘á»™ng cá»§a Dash button cÃ³ dáº¡ng nhÆ° sau: </p>
<pre><code> .--------.
| DASH ( ) | -------&gt; INTERNET -------&gt; AMAZON SERVER
 `--------&#39;
</code></pre><p>Sau khi báº¡n nháº¥n nÃºt, nÃ³ sáº½ gá»­i má»™t request tá»›i server cá»§a Amazon vÃ  thá»±c hiá»‡n lá»‡nh order. Viá»‡c chÃºng ta cáº§n lÃ m lÃ  láº­p má»™t server Ä‘á»ƒ listen vÃ  cháº·n háº¿t cÃ¡c gÃ³i tin do Dash gá»­i Ä‘i. Äá»“ng thá»i vÃ¬ Ä‘Ã£ báº¯t Ä‘Æ°á»£c event nháº¥n nÃºt, coi nhÆ° chÃºng ta cÃ³ thá»ƒ dÃ¹ng Dash Ä‘á»ƒ Ä‘iá»u khiá»ƒn thá»© gÃ¬ Ä‘Ã³ theo Ã½ mÃ¬nh tÃ¹y thÃ­ch.</p>
<pre><code> .--------.
| DASH ( ) | -------&gt; NODE SERVER ----X     INTERNET
 `--------&#39;                |
                           |
                            `-------&gt; LÃ m trÃ² mÃ¨o
</code></pre><h3 id="c-i-t-dash-button">CÃ i Ä‘áº·t Dash Button</h3>
<p>Sau khi order vá», thÃ¬ viá»‡c Ä‘áº§u tiÃªn cáº§n lÃ m Ä‘Ã³ lÃ  cáº¥u hÃ¬nh cho cÃ¡i nÃºt káº¿t ná»‘i Ä‘Æ°á»c vá»›i Wifi.</p>
<p>Äá»ƒ cáº¥u hÃ¬nh thÃ¬ chá»‰ cáº§n má»Ÿ app Amazon trÃªn Ä‘iá»‡n thoáº¡i ra, vÃ o <strong>Menu -&gt; Your Account -&gt; Add new Dash Button</strong>, sau Ä‘Ã³ lÃ m theo hÆ°á»›ng dáº«n trÃªn app, nháº¥n cÃ¡i nÃºt cá»§a Dash trong vÃ²ng 6 giÃ¢y cho tá»›i khi cÃ¡i Ä‘Ã¨n trÃªn Ä‘Ã³ chuyá»ƒn qua mÃ u xanh thÃ¬ nháº£ ra. Äiá»n pass Wifi vÃ o.</p>
<p>Sau Ä‘Ã³ app Amazon sáº½ nháº£y ra mÃ n hÃ¬nh chá»n sáº£n pháº©m cáº§n mua, táº¡i bÆ°á»›c nÃ y nhá»› <strong>Ä‘á»«ng chá»n cÃ¡i gÃ¬ cáº£</strong>, chá»‰ láº³ng láº·ng táº¯t app Ä‘i lÃ  xong.</p>
<h3 id="t-m-mac-address-c-a-dash-button">TÃ¬m MAC address cá»§a Dash Button</h3>
<p>Äá»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c Dash button thÃ¬ chÃºng ta cáº§n pháº£i láº¥y Ä‘á»‹a chá»‰ MAC cá»§a nÃ³. CÃ¡ch láº¥y thÃ¬ nhiá»u vÃ´ ká»ƒ. CÃ³ ngÆ°Ã²i sá»­ dá»¥ng cÃ¡c script chuyÃªn dá»¥ng, cÃ³ ngÆ°Ã²i tá»± viáº¿t script Ä‘á»ƒ báº¯t gÃ³i tin vÃ  tra Ä‘á»‹a chá»‰. MÃ¬nh chá»‰ trÃ¬nh bÃ y cÃ¡ch Ä‘Æ¡n giáº£n Ä‘Ã³ lÃ  dÃ¹ng <code>tcpdump</code>.</p>
<p>Äáº§u tiÃªn cháº¡y <code>tcpdump</code>:</p>
<pre><code>$ tcpdump
</code></pre><p>Náº¿u chÆ°a cÃ³ thÃ¬ cÃ³ thá»ƒ cÃ i thÃ´ng qua <code>brew</code> trÃªn macOS hoáº·c package manager cá»§a báº£n Linux báº¡n Ä‘ang xÃ i, vÃ­ dá»¥ trÃªn Arch lÃ :</p>
<pre><code>$ pacman -S tcpdump
</code></pre><p>Khi cháº¡y thÃ¬ <code>tcpdump</code> sáº½ liá»‡t kÃª toÃ n bá»™ cÃ¡c káº¿t ná»‘i trong máº¡ng, lÆ°u Ã½ khÃ´ng nÃªn sá»­ dá»¥ng khi Ä‘ang á»Ÿ trong má»™t máº¡ng cÃ³ quÃ¡ nhiá»u thiáº¿t bá»‹ (vÃ¬ lÆ°á»ng output sáº½ nhiá»u, khÃ³ tÃ¬m). LÃºc nÃ y báº¡n cÃ³ thá»ƒ báº¥m cÃ¡i nÃºt trÃªn Dash vÃ i ba láº§n vÃ  tÃ¬m output cÃ³ dáº¡ng:</p>
<pre><code>22:26:52.777174 IP 0.0.0.0.bootpc &gt; 255.255.255.255.bootps: BOOTP/DHCP, 
Request from XX:XX:XX:XX:XX:XX (oui Unknown), length 261
</code></pre><p>Trong Ä‘Ã³ <code>XX:XX:XX:XX:XX:XX</code> sáº½ lÃ  Ä‘á»‹a chá»‰ MAC cá»§a Dash button mÃ  chÃºng ta cáº§n tÃ¬m.</p>
<h3 id="t-o-server-trung-gian-b-t-request">Táº¡o server trung gian Ä‘á»ƒ báº¯t request</h3>
<p>Äá»ƒ listen cÃ¡c request tá»« Dash, chÃºng ta cÃ³ thá»ƒ dÃ¹ng thÆ° viá»‡n <a href="https://github.com/hortinstein/node-dash-button"><code>node-dash-button</code></a>. CÃ¡ch lÃ m ráº¥t Ä‘Æ¡n giáº£n:</p>
<p>Äáº§u tiÃªn, chÃºng ta táº¡o má»™t thÆ° má»¥c má»›i cho dá»± Ã¡n hacking cá»§a mÃ¬nh vÃ  khá»Ÿi táº¡o má»™t node project má»›i vá»›i <code>yarn</code> hoáº·c <code>npm</code>:</p>
<pre><code>$ mkdir dashfun
$ yarn init
</code></pre><p>Tiáº¿p theo, chÃºng ta cÃ i Ä‘áº·t gÃ³i <code>node-dash-button</code>:</p>
<pre><code>$ yarn add node-dash-button
</code></pre><p>Sau Ä‘Ã³ táº¡o file <code>main.js</code> vÃ  báº¯t Ä‘áº§u viáº¿t code:</p>
<pre><code>$ touch main.js
</code></pre><p>Ná»™i dung file <code>main.js</code> Ä‘Æ¡n giáº£n nhÆ° tháº¿ nÃ y thÃ´i:</p>
<pre><code>const DashButton = require(&#39;node-dash-button&#39;);
const dash = DashButton(&quot;XX:XX:XX:XX:XX:XX&quot;, null, null, &#39;all&#39;);

dash.on(&quot;detected&quot;, function (){
    console.log(&quot;omg found&quot;);
});
</code></pre><p>Nhá»› thay <code>XX:XX:XX:XX:XX:XX</code> báº±ng Ä‘á»‹a chá»‰ MAC cá»§a dash button báº¡n cÃ³.</p>
<p>Báº¥t cá»© khi nÃ o báº¡n nháº¥n nÃºt, thÆ° viá»‡n <code>node-dash-button</code> sáº½ báº¯t cÃ¡c gÃ³i tin vÃ  thá»±c thi hÃ m callback cá»§a sá»± kiá»‡n <code>detected</code>.</p>
<p>Äáº¿n Ä‘Ã¢y viá»‡c hack coi nhÆ° hoÃ n thÃ nh, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n thao tÃ¡c gÃ¬ Ä‘Ã³ báº¡n muá»‘n (pha cÃ  phÃª, báº­t táº¯t Ä‘Ã¨n, request gá»­i tin nháº¯n, shutdown server, cháº¡y lá»‡nh <code>rm -rf /</code>,...) tÃ¹y thÃ­ch bÃªn trong hÃ m callback nÃ y.</p>
<p>Video demo:</p>
<iframe width="700" height="400" src="https://www.youtube.com/embed/unKgZ29CrDM" frameborder="0" allowfullscreen></iframe>

<p>á» thá»i Ä‘iá»ƒm hiá»‡n táº¡i thÃ¬ chÆ°a tháº¥y ai lÃ m Ä‘Æ°á»c gÃ¬ nhiá»u hÆ¡n trong viá»‡c hack em Dash button nÃ y ngoÃ i viá»‡c báº¯t láº¡i request cá»§a nÃ³ má»—i khi nháº¥n nÃºt vÃ  thá»±c hiá»‡n má»™t thao tÃ¡c khÃ¡c báº±ng server cá»§a chÃ­nh mÃ¬nh. NÃªn trong pháº¡m vi bÃ i viáº¿t nÃ y cÅ©ng chá»‰ Ä‘á» cáº­p Ä‘áº¿n váº¥n Ä‘á» Ä‘Ã³. Sau nÃ y náº¿u tÃ¬m hiá»ƒu Ä‘Æ°á»£c thÃªm kÄ© thuáº­t gÃ¬ má»›i hÆ¡n thÃ¬ mÃ¬nh sáº½ viáº¿t thÃªm.</p>
<div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='https://huytd.github.io/tags/hardware.html'>hardware</a><a class='topic-tag' href='https://huytd.github.io/tags/hacking.html'>hacking</a><a class='topic-tag' href='https://huytd.github.io/tags/javascript.html'>javascript</a></div>
                <div class="copyright">
                Báº¡n Ä‘Æ°á»£c tÃ¹y Ã½ báº¥m like, trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n vÃ  tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, mÃ¬nh hy vá»ng tá»« nay vá» sau báº¡n sáº½ luÃ´n cáº£m tháº¥y cáº¯n rá»©t lÆ°Æ¡ng tÃ¢m, Äƒn khÃ´ng ngon, ngá»§ khÃ´ng yÃªn. ğŸ˜†
                </div>
                <div class="fb-like" data-href="http://huytd.github.io/posts/hacking-amazon-dash-button.html" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
            </div>
        </div>
	    <div class="footer">
            <p>Created with <a href="http://github.com/huytd/azeroth-js">azeroth.js</a></p>
            <div class="social">
                <a target="_blank" href="http://facebook.com/kingbazoka"><i class="icon-facebook-squared"></i></a>
                <a target="_blank" href="http://twitter.com/huydotnet"><i class="icon-twitter-squared"></i></a>
                <a target="_blank" href="http://github.com/huytd"><i class="icon-github-squared"></i></a>
                <a target="_blank" href="https://thefullsnack.com"><i class="icon-emo-coffee"></i></a>
            </div>
        </div>
        <script>
          window.fbAsyncInit = function() {
            FB.init({
              appId      : '462066520669072',
              xfbml      : true,
              version    : 'v2.6'
            });

            FB.Event.subscribe('edge.create', function(url) {
              ga('send', 'social', 'facebook', 'like', url);
            });
          };

          (function(d, s, id){
             var js, fjs = d.getElementsByTagName(s)[0];
             if (d.getElementById(id)) {return;}
             js = d.createElement(s); js.id = id;
             js.src = "//connect.facebook.net/en_US/sdk.js";
             fjs.parentNode.insertBefore(js, fjs);
           }(document, 'script', 'facebook-jssdk'));
        </script>
        <script type="text/javascript" async src="../js/MathJax.js"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea"]
          }
        });
        </script>
    </body>
</html>

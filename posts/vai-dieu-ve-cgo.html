<html>
    <head>
        <title> Kinh nghiá»‡m lÃ m viá»‡c vá»›i Cgo | Huy's Blog</title>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;"><meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
        
        <link href="../css/inconsolata.css" rel="stylesheet" type="text/css">
        <link href="../css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="../css/highlight/tomorrow.css">
        <link rel="stylesheet" href="../css/fontello.css">
        <script src="../js/highlight.pack.js"></script>
        <script>
        hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="header">
            <a href="/"><i class="icon icon-emo-coffee"></i> Huy's Blog</a>
        </div>
        <div class="container">
            <div class="main">
                <h1 id="kinh-nghi-m-l-m-vi-c-v-i-cgo">Kinh nghiá»‡m lÃ m viá»‡c vá»›i Cgo</h1>
<p>Cuá»‘i tuáº§n vá»«a rá»“i mÃ¬nh cÃ³ lÃ m má»™t project nho nhá» Ä‘á»ƒ há»c há»i thÃªm, Ä‘iá»ƒm khÃ¡ thÃº vá»‹ lÃ  project nÃ y tuy khÃ´ng to láº¯m nhÆ°ng láº¡i chá»©a khÃ¡ lÃ  nhiá»u váº¥n Ä‘á» vÃ  buá»™c mÃ¬nh pháº£i tÃ¬m hiá»ƒu sÃ¢u vÃ o ráº¥t nhiá»u máº£ng kÄ© thuáº­t.</p>
<p>Má»™t trong nhá»¯ng chá»©c nÄƒng cá»§a project nÃ y lÃ  viá»‡c chá»¥p áº£nh mÃ n hÃ¬nh (screenshot), cÅ©ng nhá» váº­y mÃ  biáº¿t Ä‘Æ°á»£c viá»‡c chá»¥p áº£nh mÃ n hÃ¬nh trÃªn tá»«ng há»‡ Ä‘iá»u hÃ nh khÃ¡c nhau lÃ  má»™t cÃ´ng viá»‡c khÃ´ng há» Ä‘Æ¡n giáº£n vÃ  cháº¯c cháº¯n khÃ´ng thá»ƒ thá»±c hiá»‡n trá»±c tiáº¿p trong Golang mÃ  pháº£i thÃ´ng qua API cá»§a tá»«ng há»‡ Ä‘iá»u hÃ nh, chÃ­nh vÃ¬ váº­y nÃªn cáº§n pháº£i Ä‘á»¥ng tá»›i Cgo. Chi tiáº¿t vá» viá»‡c chá»¥p áº£nh cháº¯c mÃ¬nh sáº½ viáº¿t á»Ÿ má»™t bÃ i viáº¿t khÃ¡c, bÃ i nÃ y mÃ¬nh chia sáº½ má»™t vÃ i Ä‘iá»u rÃºt ra khi lÃ m viá»‡c vá»›i Cgo trong 2 ngÃ y cuá»‘i tuáº§n vá»«a rá»“i.</p>
<h2 id="gi-i-thi-u-nhanh-v-cgo">Giá»›i thiá»‡u nhanh vá» Cgo</h2>
<p>Cgo tá»©c lÃ  C káº¿t há»£p vá»›i Go, nÃ³i Ä‘Æ¡n giáº£n thÃ¬ Cgo giÃºp cho Go cÃ³ thá»ƒ gá»i Ä‘Æ°á»£c code C vÃ  ngÆ°á»£c láº¡i, gá»i code C trong Go... Ã  nháº§m, gá»i code Go trong C.</p>
<p>Äá»ƒ gá»i Ä‘Æ°á»£c code C trong Go thÃ¬ chÃºng ta viáº¿t Ä‘oáº¡n code C Ä‘Ã³ trong má»™t khá»‘i comment <code>/* */</code> hoáº·c <code>//</code> rá»“i import gÃ³i <code>&quot;C&quot;</code>. TrÃ¬nh biÃªn dá»‹ch sáº½ tá»± Ä‘á»™ng chia ra, gá»i <code>gcc</code> (hoáº·c trÃ¬nh biÃªn dá»‹ch C default cá»§a mÃ¡y tÃ­nh) Ä‘á»ƒ biÃªn dá»‹ch Ä‘oáº¡n code trÃªn, sau Ä‘Ã³ go compiler sáº½ lÃ m nhiá»‡m vá»¥ liÃªn káº¿t nÃ³ vÃ o chÆ°Æ¡ng trÃ¬nh.</p>
<p>ChÃºng ta cÃ³ thá»ƒ truy cáº­p vÃ o C code thÃ´ng qua Ä‘á»‘i tÆ°á»£ng <code>C</code> trong Go, vÃ­ dá»¥:</p>
<pre><code>package main

/*
#include &lt;stdio.h&gt;

void sayHello() {
  printf(&quot;YOLO!&quot;)
}
*/
import &quot;C&quot;

func main() {
  C.sayHello()
}
</code></pre><p>Náº¿u muá»‘n tÃ¬m hiá»ƒu chi tiáº¿t hÆ¡n vá» Cgo cÃ¡c báº¡n cÃ³ thá»ƒ tham kháº£o cÃ¡c link á»Ÿ cuá»‘i bÃ i.</p>
<p>Sau Ä‘Ã¢y mÃ¬nh sáº½ nÃ³i sÆ¡ vá» má»™t vÃ i kinh nghiá»‡m mÃ¬nh gáº·p pháº£i trong quÃ¡ trÃ¬nh lÃ m viá»‡c vá»›i nÃ³.</p>
<h2 id="cygwin-kh-ng-t-ng-th-ch-v-i-cgo">Cygwin khÃ´ng tÆ°Æ¡ng thÃ­ch vá»›i Cgo</h2>
<p>Náº¿u dÃ¹ng Windows háº³n cÃ¡c báº¡n sáº½ dÃ¹ng Cygwin, vÃ  trÃ¬nh biÃªn dá»‹ch <code>gcc</code> Ä‘i kÃ¨m cá»§a Cygwin thÃ¬ khÃ´ng cÃ³ kháº£ nÄƒng biÃªn dá»‹ch Ä‘Æ°á»£c Cgo.</p>
<p>Äá»ƒ lÃ m viá»‡c vá»›i Cgo trÃªn Windows báº¡n báº¯t buá»™c pháº£i sá»­ dá»¥ng Command Line cá»§a win, vÃ  biÃªn dá»‹ch báº±ng MingGW.</p>
<h2 id="cgo-kh-ng-ch-c-c">Cgo khÃ´ng chá»‰ cÃ³ C</h2>
<p>Náº¿u lÃ m viá»‡c trÃªn Mac, báº¡n cÃ²n cÃ³ thá»ƒ dÃ¹ng Cgo Ä‘á»ƒ gá»i code Objective-C vÃ  xÃ i cÃ¡c framework cá»§a Objective-C nhÆ° Cocoa ngay trong Go luÃ´n cÅ©ng Ä‘Æ°á»£c, vÃ­ dá»¥:</p>
<pre><code>/*
#cgo CFLAGS: -x objective-c
#cgo LDFLAGS: -framework Cocoa -framework Foundation
#import &lt;Cocoa/Cocoa.h&gt;
#import &lt;Foundation/Foundation.h&gt;

...
*/
</code></pre><h2 id="memory-leak-t-ph-a-c">Memory Leak tá»« phÃ­a C</h2>
<p>Go cÃ³ garbage collector (GC), vÃ  GC cá»§a Go hoáº¡t Ä‘á»™ng trong lÃºc runtime luÃ´n. NhÆ°ng C thÃ¬ khÃ´ng nhÆ° váº­y. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  khi lÃ m khá»Ÿi táº¡o cÃ¡c object bÃªn trong pháº§n C, báº¡n pháº£i quáº£n lÃ½ chÃºng báº±ng tay (táº¡o ra thÃ¬ nhá»› há»§y nÃ³ Ä‘i), náº¿u khÃ´ng thÃ¬ memleak sáº½ lÃ  má»™t váº¥n Ä‘á» Ä‘au Ä‘áº§u. </p>
<p>CÃ¡ch Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ phÃ¡t hiá»‡n memleak lÃ  dÃ¹ng Task Manager cá»§a Windows hoáº·c Activity Monitor cá»§a Mac theo dÃµi bá»™ nhá»› sá»­ dá»¥ng cá»§a chÆ°Æ¡ng trÃ¬nh, náº¿u code logic cá»§a báº¡n khÃ´ng lÃ m gÃ¬ nhiá»u nhÆ°ng memory cá»© tÄƒng lÃªn liÃªn tá»¥c, thÃ¬ kháº£ nÄƒng Ä‘Ã³ lÃ  nÃ³ Ä‘ang bá»‹ leak.</p>
<h2 id="th-i-gian-build-ch-m-h-n">Thá»i gian build cháº­m hÆ¡n</h2>
<p>RÃµ rÃ ng rá»“i, thay vÃ¬ chá»‰ cÃ³ Go compiler biÃªn dá»‹ch chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n, thÃ¬ láº§n nÃ y trong build process pháº£i cháº¡y Ä‘áº¿n 2 compiler (GCC vÃ  Go compiler) biÃªn dá»‹ch 2 láº§n code vÃ  link chÃºng láº¡i vá»›i nhau.</p>
<h2 id="v-n-dependencies-khi-deploy">Váº¥n Ä‘á» dependencies khi deploy</h2>
<p>Náº¿u dÃ¹ng Cgo, khi user cÃ i Ä‘áº·t chÆ°Æ¡ng trÃ¬nh Go cá»§a báº¡n thÃ¬ trÃªn mÃ¡y tÃ­nh cá»§a há» ngoÃ i cÃ¡c thÆ° viá»‡n mÃ  Go phá»¥ thuá»™c ra, há» cÃ²n pháº£i cÃ i Ä‘áº·t thÃªm cÃ¡c thÆ° viá»‡n mÃ  pháº§n code C cá»§a báº¡n cáº§n dÃ¹ng tá»›i. Äiá»u nÃ y sáº½ khiáº¿n cho viá»‡c deployment tá»‘n thÃªm vÃ i bÆ°á»›c ná»¯a Ä‘á»ƒ Ä‘áº£m báº£o chÆ°Æ¡ng trÃ¬nh cháº¡y tá»‘t.</p>
<p>Ãˆo, táº¡m thá»i tuáº§n nÃ y mÃ¬nh chá»‰ ghi ra Ä‘Æ°á»£c má»™t vÃ i Ã½ Ä‘Æ¡n giáº£n váº­y, cÃ²n nhiá»u thá»© ná»¯a nhÆ°ng mÃ  giá» chÆ°a há»‡ thá»‘ng láº¡i Ä‘á»ƒ diá»…n Ä‘áº¡t má»™t cÃ¡ch gá»n gÃ ng Ä‘Æ°á»ng, cháº¯c pháº£i háº¹n tuáº§n sau thÃ´i :D NhÆ°ng káº¿t luáº­n lÃ : Cgo lÃ  má»™t chá»©c nÄƒng khÃ¡ hay vÃ  quan trá»ng cá»§a Go, giÃºp má»Ÿ rá»™ng Go Ä‘á»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng sá»©c máº¡nh cá»§a nhiá»u cÃ´ng nghá»‡ khÃ¡c, nhÆ°ng báº¥t cá»© thá»© cÃ´ng nghá»‡ nÃ o cÅ©ng Ä‘á»u cÃ³ 2 máº·t, thá»© gÃ¬ cÃ ng hay thÃ¬ cÃ ng cáº§n pháº£i tÃ¬m hiá»ƒu rÃµ vá» nÃ³ Ä‘á»ƒ biáº¿t khi nÃ o cáº§n xÃ i, khi nÃ o thÃ¬ nÃªn trÃ¡nh. ÄÃºng vá»›i cÃ¢u nÃ³i vui cá»§a má»™t anh báº¡n mÃ¬nh:</p>
<blockquote>
<p>Hiá»ƒu Ä‘á»ƒ xÃ i nhau tá»‘t hÆ¡n</p>
</blockquote>
<p>Chá»‘t bÃ i viáº¿t mÃ¬nh xin dáº«n má»™t vÃ i link nÃªn Ä‘á»c vá» Cgo cho báº¡n nÃ o muá»‘n tÃ¬m hiá»ƒu sÃ¢u thÃªm vá» nÃ³:</p>
<p> <a href="https://blog.golang.org/c-go-cgo">[1] Go Blog - C? Go? Cgo!</a></p>
<p> <a href="https://golang.org/cmd/cgo/">[2] Godoc - Command cgo</a></p>
<p> <a href="https://github.com/golang/go/wiki/cgo">[3] Wiki Cgo</a></p>
<p> <a href="http://dave.cheney.net/2016/01/18/cgo-is-not-go">[4] Blog cá»§a bÃ¡c Dave Cheney - Cgo is not Go</a></p>
<p> <a href="https://www.cockroachlabs.com/blog/the-cost-and-complexity-of-cgo/">[5] Cockroach Labs - The Cost and Complexity of Cgo</a></p>

                <div class="copyright">
                Báº¡n Ä‘Æ°á»£c tÃ¹y Ã½ báº¥m like, trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n vÃ  tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, mÃ¬nh hy vá»ng tá»« nay vá» sau báº¡n sáº½ luÃ´n cáº£m tháº¥y cáº¯n rá»©t lÆ°Æ¡ng tÃ¢m, Äƒn khÃ´ng ngon, ngá»§ khÃ´ng yÃªn. ğŸ˜†
                </div>
            </div>
        </div>
	    <div class="footer">
            <p>Created with <a href="http://github.com/huytd/azeroth-js">azeroth.js</a></p>
            <div class="social">
                <a target="_blank" href="http://facebook.com/kingbazoka"><i class="icon-facebook-squared"></i></a>
                <a target="_blank" href="http://twitter.com/huydotnet"><i class="icon-twitter-squared"></i></a>
                <a target="_blank" href="http://github.com/huytd"><i class="icon-github-squared"></i></a>
                <a target="_blank" href="https://thefullsnack.com"><i class="icon-emo-coffee"></i></a>
            </div>
        </div>
        <script type="text/javascript" async src="https://cdn.rawgit.com/mathjax/MathJax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea"]
          }
        });
        </script>
    </body>
</html>
